{"version":3,"file":"Help.9FwSwDTf.js","sources":["../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub.svelte","../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub-content.svelte","../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub-trigger.svelte","../../../../../../node_modules/eventsource-parser/dist/index.js","../../../../../../node_modules/eventsource-parser/dist/stream.js","../../../../../../src/lib/apis/streaming/index.ts","../../../../../../src/lib/components/common/Banner.svelte","../../../../../../src/lib/components/icons/DocumentArrowUpSolid.svelte","../../../../../../src/lib/components/icons/GlobeAltSolid.svelte","../../../../../../src/lib/components/icons/WrenchSolid.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu.svelte","../../../../../../src/lib/components/icons/Headphone.svelte","../../../../../../src/lib/components/chat/MessageInput/VoiceRecording.svelte","../../../../../../src/lib/components/chat/MessageInput/FilesOverlay.svelte","../../../../../../src/lib/components/chat/MessageInput/Commands/Prompts.svelte","../../../../../../src/lib/components/chat/MessageInput/Commands/Documents.svelte","../../../../../../src/lib/components/chat/MessageInput/Commands/Models.svelte","../../../../../../src/lib/components/chat/MessageInput/Commands.svelte","../../../../../../src/lib/components/icons/XMark.svelte","../../../../../../src/lib/components/chat/MessageInput.svelte","../../../../../../src/lib/components/chat/ModelSelector.svelte","../../../../../../src/lib/components/layout/Navbar/Menu.svelte","../../../../../../src/lib/components/icons/AdjustmentsHorizontal.svelte","../../../../../../src/lib/components/layout/Navbar.svelte","../../../../../../src/lib/components/chat/Controls/Valves.svelte","../../../../../../src/lib/components/chat/Controls/Controls.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay/VideoInputMenu.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay.svelte","../../../../../../src/lib/components/common/Drawer.svelte","../../../../../../src/lib/components/chat/ChatControls.svelte","../../../../../../src/lib/components/chat/Chat.svelte","../../../../../../src/lib/components/chat/ShortcutsModal.svelte","../../../../../../src/lib/components/icons/QuestionMarkCircle.svelte","../../../../../../src/lib/components/icons/Keyboard.svelte","../../../../../../src/lib/components/layout/Help/HelpMenu.svelte","../../../../../../src/lib/components/layout/Help.svelte"],"sourcesContent":["<script>import { derived } from \"svelte/store\";\nimport { setSubMenuCtx } from \"../ctx.js\";\nexport let disabled = void 0;\nexport let open = void 0;\nexport let onOpenChange = void 0;\nconst {\n  updateOption,\n  ids,\n  states: { subOpen }\n} = setSubMenuCtx({\n  disabled,\n  onOpenChange: ({ next }) => {\n    if (open !== next) {\n      onOpenChange?.(next);\n      open = next;\n    }\n    return next;\n  }\n});\nconst idValues = derived([ids.menu, ids.trigger], ([$menuId, $triggerId]) => ({\n  menu: $menuId,\n  trigger: $triggerId\n}));\n$:\n  open !== void 0 && subOpen.set(open);\n$:\n  updateOption(\"disabled\", disabled);\n</script>\n\n<slot subIds={$idValues} />\n","<script>import { melt } from \"@melt-ui/svelte\";\nimport { createDispatcher } from \"../../../internal/index.js\";\nimport { getSubmenuCtx, updateSubPositioning } from \"../ctx.js\";\nexport let transition = void 0;\nexport let transitionConfig = void 0;\nexport let inTransition = void 0;\nexport let inTransitionConfig = void 0;\nexport let outTransition = void 0;\nexport let outTransitionConfig = void 0;\nexport let asChild = false;\nexport let id = void 0;\nexport let side = \"right\";\nexport let align = \"start\";\nexport let sideOffset = 0;\nexport let alignOffset = 0;\nexport let collisionPadding = 8;\nexport let avoidCollisions = true;\nexport let collisionBoundary = void 0;\nexport let sameWidth = false;\nexport let fitViewport = false;\nexport let strategy = \"absolute\";\nexport let overlap = false;\nexport let el = void 0;\nconst {\n  elements: { subMenu },\n  states: { subOpen },\n  ids,\n  getAttrs\n} = getSubmenuCtx();\nconst dispatch = createDispatcher();\nconst attrs = getAttrs(\"sub-content\");\n$:\n  if (id) {\n    ids.menu.set(id);\n  }\n$:\n  builder = $subMenu;\n$:\n  Object.assign(builder, attrs);\n$:\n  updateSubPositioning({\n    side,\n    align,\n    sideOffset,\n    alignOffset,\n    collisionPadding,\n    avoidCollisions,\n    collisionBoundary,\n    sameWidth,\n    fitViewport,\n    strategy,\n    overlap\n  });\n</script>\n\n{#if asChild && $subOpen}\n\t<slot {builder} />\n{:else if transition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\ttransition:transition={transitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if inTransition && outTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tin:inTransition={inTransitionConfig}\n\t\tout:outTransition={outTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if inTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tin:inTransition={inTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if outTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tout:outTransition={outTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{/if}\n","<script>import { melt } from \"@melt-ui/svelte\";\nimport { disabledAttrs } from \"../../../internal/index.js\";\nimport { getSubTrigger } from \"../ctx.js\";\nimport { createDispatcher } from \"../../../internal/events.js\";\nexport let disabled = false;\nexport let asChild = false;\nexport let id = void 0;\nexport let el = void 0;\nconst {\n  elements: { subTrigger },\n  ids,\n  getAttrs,\n  options\n} = getSubTrigger();\nconst { disabled: disabledStore } = options;\nconst dispatch = createDispatcher();\n$:\n  if (id) {\n    ids.trigger.set(id);\n  }\n$:\n  builder = $subTrigger;\n$:\n  attrs = {\n    ...getAttrs(\"sub-trigger\"),\n    ...disabledAttrs(disabled || $disabledStore)\n  };\n$:\n  Object.assign(builder, attrs);\n</script>\n\n{#if asChild}\n\t<slot {builder} />\n{:else}\n\t<div\n\t\tbind:this={el}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-click={dispatch}\n\t\ton:m-focusin={dispatch}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointerleave={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{/if}\n","function createParser(onParse) {\n  let isFirstChunk;\n  let buffer;\n  let startingPosition;\n  let startingFieldLength;\n  let eventId;\n  let eventName;\n  let data;\n  reset();\n  return {\n    feed,\n    reset\n  };\n  function reset() {\n    isFirstChunk = true;\n    buffer = \"\";\n    startingPosition = 0;\n    startingFieldLength = -1;\n    eventId = void 0;\n    eventName = void 0;\n    data = \"\";\n  }\n  function feed(chunk) {\n    buffer = buffer ? buffer + chunk : chunk;\n    if (isFirstChunk && hasBom(buffer)) {\n      buffer = buffer.slice(BOM.length);\n    }\n    isFirstChunk = false;\n    const length = buffer.length;\n    let position = 0;\n    let discardTrailingNewline = false;\n    while (position < length) {\n      if (discardTrailingNewline) {\n        if (buffer[position] === \"\\n\") {\n          ++position;\n        }\n        discardTrailingNewline = false;\n      }\n      let lineLength = -1;\n      let fieldLength = startingFieldLength;\n      let character;\n      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {\n        character = buffer[index];\n        if (character === \":\" && fieldLength < 0) {\n          fieldLength = index - position;\n        } else if (character === \"\\r\") {\n          discardTrailingNewline = true;\n          lineLength = index - position;\n        } else if (character === \"\\n\") {\n          lineLength = index - position;\n        }\n      }\n      if (lineLength < 0) {\n        startingPosition = length - position;\n        startingFieldLength = fieldLength;\n        break;\n      } else {\n        startingPosition = 0;\n        startingFieldLength = -1;\n      }\n      parseEventStreamLine(buffer, position, fieldLength, lineLength);\n      position += lineLength + 1;\n    }\n    if (position === length) {\n      buffer = \"\";\n    } else if (position > 0) {\n      buffer = buffer.slice(position);\n    }\n  }\n  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        onParse({\n          type: \"event\",\n          id: eventId,\n          event: eventName || void 0,\n          data: data.slice(0, -1)\n          // remove trailing newline\n        });\n\n        data = \"\";\n        eventId = void 0;\n      }\n      eventName = void 0;\n      return;\n    }\n    const noValue = fieldLength < 0;\n    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));\n    let step = 0;\n    if (noValue) {\n      step = lineLength;\n    } else if (lineBuffer[index + fieldLength + 1] === \" \") {\n      step = fieldLength + 2;\n    } else {\n      step = fieldLength + 1;\n    }\n    const position = index + step;\n    const valueLength = lineLength - step;\n    const value = lineBuffer.slice(position, position + valueLength).toString();\n    if (field === \"data\") {\n      data += value ? \"\".concat(value, \"\\n\") : \"\\n\";\n    } else if (field === \"event\") {\n      eventName = value;\n    } else if (field === \"id\" && !value.includes(\"\\0\")) {\n      eventId = value;\n    } else if (field === \"retry\") {\n      const retry = parseInt(value, 10);\n      if (!Number.isNaN(retry)) {\n        onParse({\n          type: \"reconnect-interval\",\n          value: retry\n        });\n      }\n    }\n  }\n}\nconst BOM = [239, 187, 191];\nfunction hasBom(buffer) {\n  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);\n}\nexport { createParser };\n//# sourceMappingURL=index.js.map\n","import { createParser } from './index.js';\nclass EventSourceParserStream extends TransformStream {\n  constructor() {\n    let parser;\n    super({\n      start(controller) {\n        parser = createParser(event => {\n          if (event.type === \"event\") {\n            controller.enqueue(event);\n          }\n        });\n      },\n      transform(chunk) {\n        parser.feed(chunk);\n      }\n    });\n  }\n}\nexport { EventSourceParserStream };\n//# sourceMappingURL=stream.js.map\n","import { EventSourceParserStream } from 'eventsource-parser/stream';\nimport type { ParsedEvent } from 'eventsource-parser';\n\ntype TextStreamUpdate = {\n\tdone: boolean;\n\tvalue: string;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tcitations?: any;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\terror?: any;\n\tusage?: ResponseUsage;\n};\n\ntype ResponseUsage = {\n\t/** Including images and tools if any */\n\tprompt_tokens: number;\n\t/** The tokens generated */\n\tcompletion_tokens: number;\n\t/** Sum of the above two fields */\n\ttotal_tokens: number;\n};\n\n// createOpenAITextStream takes a responseBody with a SSE response,\n// and returns an async generator that emits delta updates with large deltas chunked into random sized chunks\nexport async function createOpenAITextStream(\n\tresponseBody: ReadableStream<Uint8Array>,\n\tsplitLargeDeltas: boolean\n): Promise<AsyncGenerator<TextStreamUpdate>> {\n\tconst eventStream = responseBody\n\t\t.pipeThrough(new TextDecoderStream())\n\t\t.pipeThrough(new EventSourceParserStream())\n\t\t.getReader();\n\tlet iterator = openAIStreamToIterator(eventStream);\n\tif (splitLargeDeltas) {\n\t\titerator = streamLargeDeltasAsRandomChunks(iterator);\n\t}\n\treturn iterator;\n}\n\nasync function* openAIStreamToIterator(\n\treader: ReadableStreamDefaultReader<ParsedEvent>\n): AsyncGenerator<TextStreamUpdate> {\n\twhile (true) {\n\t\tconst { value, done } = await reader.read();\n\t\tif (done) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\t\tif (!value) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = value.data;\n\t\tif (data.startsWith('[DONE]')) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\n\t\ttry {\n\t\t\tconst parsedData = JSON.parse(data);\n\t\t\tconsole.log(parsedData);\n\n\t\t\tif (parsedData.error) {\n\t\t\t\tyield { done: true, value: '', error: parsedData.error };\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (parsedData.citations) {\n\t\t\t\tyield { done: false, value: '', citations: parsedData.citations };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tyield {\n\t\t\t\tdone: false,\n\t\t\t\tvalue: parsedData.choices?.[0]?.delta?.content ?? '',\n\t\t\t\tusage: parsedData.usage\n\t\t\t};\n\t\t} catch (e) {\n\t\t\tconsole.error('Error extracting delta from SSE event:', e);\n\t\t}\n\t}\n}\n\n// streamLargeDeltasAsRandomChunks will chunk large deltas (length > 5) into random sized chunks between 1-3 characters\n// This is to simulate a more fluid streaming, even though some providers may send large chunks of text at once\nasync function* streamLargeDeltasAsRandomChunks(\n\titerator: AsyncGenerator<TextStreamUpdate>\n): AsyncGenerator<TextStreamUpdate> {\n\tfor await (const textStreamUpdate of iterator) {\n\t\tif (textStreamUpdate.done) {\n\t\t\tyield textStreamUpdate;\n\t\t\treturn;\n\t\t}\n\t\tif (textStreamUpdate.citations) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tlet content = textStreamUpdate.value;\n\t\tif (content.length < 5) {\n\t\t\tyield { done: false, value: content };\n\t\t\tcontinue;\n\t\t}\n\t\twhile (content != '') {\n\t\t\tconst chunkSize = Math.min(Math.floor(Math.random() * 3) + 1, content.length);\n\t\t\tconst chunk = content.slice(0, chunkSize);\n\t\t\tyield { done: false, value: chunk };\n\t\t\t// Do not sleep if the tab is hidden\n\t\t\t// Timers are throttled to 1s in hidden tabs\n\t\t\tif (document?.visibilityState !== 'hidden') {\n\t\t\t\tawait sleep(5);\n\t\t\t}\n\t\t\tcontent = content.slice(chunkSize);\n\t\t}\n\t}\n}\n\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n","<script lang=\"ts\">\n\timport type { Banner } from '$lib/types';\n\timport { onMount, createEventDispatcher } from 'svelte';\n\timport { fade } from 'svelte/transition';\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let banner: Banner = {\n\t\tid: '',\n\t\ttype: 'info',\n\t\ttitle: '',\n\t\tcontent: '',\n\t\turl: '',\n\t\tdismissable: true,\n\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t};\n\n\texport let dismissed = false;\n\n\tlet mounted = false;\n\n\tconst classNames: Record<string, string> = {\n\t\tinfo: 'bg-blue-500/20 text-blue-700 dark:text-blue-200 ',\n\t\tsuccess: 'bg-green-500/20 text-green-700 dark:text-green-200',\n\t\twarning: 'bg-yellow-500/20 text-yellow-700 dark:text-yellow-200',\n\t\terror: 'bg-red-500/20 text-red-700 dark:text-red-200'\n\t};\n\n\tconst dismiss = (id) => {\n\t\tdismissed = true;\n\t\tdispatch('dismiss', id);\n\t};\n\n\tonMount(() => {\n\t\tmounted = true;\n\t});\n</script>\n\n{#if !dismissed}\n\t{#if mounted}\n\t\t<div\n\t\t\tclass=\" top-0 left-0 right-0 p-2 mx-4 px-3 flex justify-center items-center relative rounded-xl border border-gray-50 dark:border-gray-850 text-gray-800 dark:text-gary-100 bg-white dark:bg-gray-900 backdrop-blur-xl z-30\"\n\t\t\ttransition:fade={{ delay: 100, duration: 300 }}\n\t\t>\n\t\t\t<div class=\" flex flex-col md:flex-row md:items-center flex-1 text-sm w-fit gap-1.5\">\n\t\t\t\t<div class=\"flex justify-between self-start\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" text-xs font-bold {classNames[banner.type] ??\n\t\t\t\t\t\t\tclassNames['info']}  w-fit px-2 rounded uppercase line-clamp-1 mr-0.5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{banner.type}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if banner.url}\n\t\t\t\t\t\t<div class=\"flex md:hidden group w-fit md:items-center\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-semibold underline\"\n\t\t\t\t\t\t\t\thref=\"/assets/files/whitepaper.pdf\"\n\t\t\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\n\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<!--  -->\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex-1 text-xs text-gray-700 dark:text-white\">\n\t\t\t\t\t{banner.content}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if banner.url}\n\t\t\t\t<div class=\"hidden md:flex group w-fit md:items-center\">\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-semibold underline\"\n\t\t\t\t\t\thref=\"/\"\n\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\n\t\t\t\t\t>\n\n\t\t\t\t\t<div class=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\">\n\t\t\t\t\t\t<!--  -->\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t\t<div class=\"flex self-start\">\n\t\t\t\t{#if banner.dismissible}\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdismiss(banner.id);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclass=\"  -mt-1 -mb-2 -translate-y-[1px] ml-1.5 mr-1 text-gray-400 dark:hover:text-white\"\n\t\t\t\t\t\t>&times;</button\n\t\t\t\t\t>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6.905 9.97a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72V18a.75.75 0 0 0 1.5 0v-4.19l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n\t<path\n\t\td=\"M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\td=\"M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M12 6.75a5.25 5.25 0 0 1 6.775-5.025.75.75 0 0 1 .313 1.248l-3.32 3.319c.063.475.276.934.641 1.299.365.365.824.578 1.3.64l3.318-3.319a.75.75 0 0 1 1.248.313 5.25 5.25 0 0 1-5.472 6.756c-1.018-.086-1.87.1-2.309.634L7.344 21.3A3.298 3.298 0 1 1 2.7 16.657l8.684-7.151c.533-.44.72-1.291.634-2.309A5.342 5.342 0 0 1 12 6.75ZM4.117 19.125a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75h-.008a.75.75 0 0 1-.75-.75v-.008Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext } from 'svelte';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport DocumentArrowUpSolid from '$lib/components/icons/DocumentArrowUpSolid.svelte';\n\timport Switch from '$lib/components/common/Switch.svelte';\n\timport GlobeAltSolid from '$lib/components/icons/GlobeAltSolid.svelte';\n\timport { config } from '$lib/stores';\n\timport WrenchSolid from '$lib/components/icons/WrenchSolid.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let uploadFilesHandler: Function;\n\n\texport let selectedToolIds: string[] = [];\n\texport let webSearchEnabled: boolean;\n\n\texport let tools = {};\n\texport let onClose: Function;\n\n\t$: tools = Object.fromEntries(\n\t\tObject.keys(tools).map((toolId) => [\n\t\t\ttoolId,\n\t\t\t{\n\t\t\t\t...tools[toolId],\n\t\t\t\tenabled: selectedToolIds.includes(toolId)\n\t\t\t}\n\t\t])\n\t);\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<Tooltip content={$i18n.t('More')}>\n\t\t<slot />\n\t</Tooltip>\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow\"\n\t\t\tsideOffset={15}\n\t\t\talignOffset={-8}\n\t\t\tside=\"top\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#if Object.keys(tools).length > 0}\n\t\t\t\t<div class=\"  max-h-28 overflow-y-auto scrollbar-hidden\">\n\t\t\t\t\t{#each Object.keys(tools) as toolId}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex-1 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<WrenchSolid />\n\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.description ?? ''} className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">{tools[toolId].name}</div>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\tbind:state={tools[toolId].enabled}\n\t\t\t\t\t\t\t\ton:change={(e) => {\n\t\t\t\t\t\t\t\t\tselectedToolIds = e.detail\n\t\t\t\t\t\t\t\t\t\t? [...selectedToolIds, toolId]\n\t\t\t\t\t\t\t\t\t\t: selectedToolIds.filter((id) => id !== toolId);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\n\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 my-1\" />\n\t\t\t{/if}\n\n\t\t\t{#if $config?.features?.enable_web_search}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex-1 flex items-center gap-2\">\n\t\t\t\t\t\t<GlobeAltSolid />\n\t\t\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Web Search')}</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<Switch bind:state={webSearchEnabled} />\n\t\t\t\t</div>\n\n\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 my-1\" />\n\t\t\t{/if}\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tuploadFilesHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<DocumentArrowUpSolid />\n\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Upload Files')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '0';\n</script>\n\n<svg\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { createEventDispatcher, tick, getContext } from 'svelte';\n\timport { config, settings } from '$lib/stores';\n\timport { blobToFile, calculateSHA256, findWordIndices } from '$lib/utils';\n\n\timport { transcribeAudio } from '$lib/apis/audio';\n\n\tconst i18n = getContext('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let recording = false;\n\n\tlet loading = false;\n\tlet confirmed = false;\n\n\tlet durationSeconds = 0;\n\tlet durationCounter = null;\n\n\tlet transcription = '';\n\n\tconst startDurationCounter = () => {\n\t\tdurationCounter = setInterval(() => {\n\t\t\tdurationSeconds++;\n\t\t}, 1000);\n\t};\n\n\tconst stopDurationCounter = () => {\n\t\tclearInterval(durationCounter);\n\t\tdurationSeconds = 0;\n\t};\n\n\t$: if (recording) {\n\t\tstartRecording();\n\t} else {\n\t\tstopRecording();\n\t}\n\n\tconst formatSeconds = (seconds) => {\n\t\tconst minutes = Math.floor(seconds / 60);\n\t\tconst remainingSeconds = seconds % 60;\n\t\tconst formattedSeconds = remainingSeconds < 10 ? `0${remainingSeconds}` : remainingSeconds;\n\t\treturn `${minutes}:${formattedSeconds}`;\n\t};\n\n\tlet speechRecognition;\n\n\tlet mediaRecorder;\n\tlet audioChunks = [];\n\n\tconst MIN_DECIBELS = -45;\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\n\n\tlet visualizerData = Array(VISUALIZER_BUFFER_LENGTH).fill(0);\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst normalizeRMS = (rms) => {\n\t\trms = rms * 10;\n\t\tconst exp = 1.5; // Adjust exponent value; values greater than 1 expand larger numbers more and compress smaller numbers more\n\t\tconst scaledRMS = Math.pow(rms, exp);\n\n\t\t// Scale between 0.01 (1%) and 1.0 (100%)\n\t\treturn Math.min(1.0, Math.max(0.01, scaledRMS));\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!recording || loading) return;\n\n\t\t\t\tif (recording && !loading) {\n\t\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\t\tconst rmsLevel = calculateRMS(timeDomainData);\n\t\t\t\t\t// Push the calculated decibel level to visualizerData\n\t\t\t\t\tvisualizerData.push(normalizeRMS(rmsLevel));\n\n\t\t\t\t\t// Ensure visualizerData array stays within the buffer length\n\t\t\t\t\tif (visualizerData.length >= VISUALIZER_BUFFER_LENGTH) {\n\t\t\t\t\t\tvisualizerData.shift();\n\t\t\t\t\t}\n\n\t\t\t\t\tvisualizerData = visualizerData;\n\n\t\t\t\t\t// if (domainData.some((value) => value > 0)) {\n\t\t\t\t\t// \tlastSoundTime = Date.now();\n\t\t\t\t\t// }\n\n\t\t\t\t\t// if (recording && Date.now() - lastSoundTime > 3000) {\n\t\t\t\t\t// \tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t// \t\tconfirmRecording();\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tconst transcribeHandler = async (audioBlob) => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\n\n\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res.text);\n\t\t\tdispatch('confirm', res.text);\n\t\t}\n\t};\n\n\tconst saveRecording = (blob) => {\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\tdocument.body.appendChild(a);\n\t\ta.style = 'display: none';\n\t\ta.href = url;\n\t\ta.download = 'recording.wav';\n\t\ta.click();\n\t\twindow.URL.revokeObjectURL(url);\n\t};\n\n\tconst startRecording = async () => {\n\t\tstartDurationCounter();\n\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t\tmediaRecorder = new MediaRecorder(stream);\n\t\tmediaRecorder.onstart = () => {\n\t\t\tconsole.log('Recording started');\n\t\t\taudioChunks = [];\n\t\t\tanalyseAudio(stream);\n\t\t};\n\t\tmediaRecorder.ondataavailable = (event) => audioChunks.push(event.data);\n\t\tmediaRecorder.onstop = async () => {\n\t\t\tconsole.log('Recording stopped');\n\t\t\tif (($settings?.audio?.stt?.engine ?? '') === 'web') {\n\t\t\t\taudioChunks = [];\n\t\t\t} else {\n\t\t\t\tif (confirmed) {\n\t\t\t\t\tconst audioBlob = new Blob(audioChunks, { type: 'audio/wav' });\n\n\t\t\t\t\tawait transcribeHandler(audioBlob);\n\n\t\t\t\t\tconfirmed = false;\n\t\t\t\t\tloading = false;\n\t\t\t\t}\n\t\t\t\taudioChunks = [];\n\t\t\t\trecording = false;\n\t\t\t}\n\t\t};\n\t\tmediaRecorder.start();\n\t\tif ($config.audio.stt.engine === 'web' || ($settings?.audio?.stt?.engine ?? '') === 'web') {\n\t\t\tif ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {\n\t\t\t\t// Create a SpeechRecognition object\n\t\t\t\tspeechRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\n\n\t\t\t\t// Set continuous to true for continuous recognition\n\t\t\t\tspeechRecognition.continuous = true;\n\n\t\t\t\t// Set the timeout for turning off the recognition after inactivity (in milliseconds)\n\t\t\t\tconst inactivityTimeout = 2000; // 3 seconds\n\n\t\t\t\tlet timeoutId;\n\t\t\t\t// Start recognition\n\t\t\t\tspeechRecognition.start();\n\n\t\t\t\t// Event triggered when speech is recognized\n\t\t\t\tspeechRecognition.onresult = async (event) => {\n\t\t\t\t\t// Clear the inactivity timeout\n\t\t\t\t\tclearTimeout(timeoutId);\n\n\t\t\t\t\t// Handle recognized speech\n\t\t\t\t\tconsole.log(event);\n\t\t\t\t\tconst transcript = event.results[Object.keys(event.results).length - 1][0].transcript;\n\n\t\t\t\t\ttranscription = `${transcription}${transcript}`;\n\n\t\t\t\t\tawait tick();\n\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\n\n\t\t\t\t\t// Restart the inactivity timeout\n\t\t\t\t\ttimeoutId = setTimeout(() => {\n\t\t\t\t\t\tconsole.log('Speech recognition turned off due to inactivity.');\n\t\t\t\t\t\tspeechRecognition.stop();\n\t\t\t\t\t}, inactivityTimeout);\n\t\t\t\t};\n\n\t\t\t\t// Event triggered when recognition is ended\n\t\t\t\tspeechRecognition.onend = function () {\n\t\t\t\t\t// Restart recognition after it ends\n\t\t\t\t\tconsole.log('recognition ended');\n\n\t\t\t\t\tconfirmRecording();\n\t\t\t\t\tdispatch('confirm', transcription);\n\n\t\t\t\t\tconfirmed = false;\n\t\t\t\t\tloading = false;\n\t\t\t\t};\n\n\t\t\t\t// Event triggered when an error occurs\n\t\t\t\tspeechRecognition.onerror = function (event) {\n\t\t\t\t\tconsole.log(event);\n\t\t\t\t\ttoast.error($i18n.t(`Speech recognition error: {{error}}`, { error: event.error }));\n\t\t\t\t\tdispatch('cancel');\n\n\t\t\t\t\tstopRecording();\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecording = async () => {\n\t\tif (recording && mediaRecorder) {\n\t\t\tawait mediaRecorder.stop();\n\t\t}\n\t\tstopDurationCounter();\n\t\taudioChunks = [];\n\t};\n\n\tconst confirmRecording = async () => {\n\t\tloading = true;\n\t\tconfirmed = true;\n\n\t\tif (recording && mediaRecorder) {\n\t\t\tawait mediaRecorder.stop();\n\t\t}\n\t\tclearInterval(durationCounter);\n\t};\n</script>\n\n<div\n\tclass=\"{loading\n\t\t? ' bg-gray-100/50 dark:bg-gray-850/50'\n\t\t: 'bg-indigo-300/10 dark:bg-indigo-500/10 '} rounded-full flex p-2.5\"\n>\n\t<div class=\"flex items-center mr-1\">\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"p-1.5\n\n            {loading\n\t\t\t\t? ' bg-gray-200 dark:bg-gray-700/50'\n\t\t\t\t: 'bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 '} \n\n\n             rounded-full\"\n\t\t\ton:click={async () => {\n\t\t\t\tdispatch('cancel');\n\t\t\t\tstopRecording();\n\t\t\t}}\n\t\t>\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tstroke-width=\"3\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tclass=\"size-4\"\n\t\t\t>\n\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\n\t\t\t</svg>\n\t\t</button>\n\t</div>\n\n\t<div\n\t\tclass=\"flex flex-1 self-center items-center justify-between ml-2 mx-1 overflow-hidden h-6\"\n\t\tdir=\"rtl\"\n\t>\n\t\t<div class=\"flex-1 flex items-center gap-0.5 h-6\">\n\t\t\t{#each visualizerData.slice().reverse() as rms}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-[2px]\n                    \n                    {loading\n\t\t\t\t\t\t? ' bg-gray-500 dark:bg-gray-400   '\n\t\t\t\t\t\t: 'bg-indigo-500 dark:bg-indigo-400  '} \n                    \n                    inline-block h-full\"\n\t\t\t\t\tstyle=\"height: {Math.min(100, Math.max(14, rms * 100))}%;\"\n\t\t\t\t/>\n\t\t\t{/each}\n\t\t</div>\n\t</div>\n\n\t<div class=\"  mx-1.5 pr-1 flex justify-center items-center\">\n\t\t<div\n\t\t\tclass=\"text-sm\n        \n        \n        {loading ? ' text-gray-500  dark:text-gray-400  ' : ' text-indigo-400 '} \n       font-medium flex-1 mx-auto text-center\"\n\t\t>\n\t\t\t{formatSeconds(durationSeconds)}\n\t\t</div>\n\t</div>\n\n\t<div class=\"flex items-center mr-1\">\n\t\t{#if loading}\n\t\t\t<div class=\" text-gray-500 rounded-full cursor-not-allowed\">\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"24\"\n\t\t\t\t\theight=\"24\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t><style>\n\t\t\t\t\t\t.spinner_OSmW {\n\t\t\t\t\t\t\ttransform-origin: center;\n\t\t\t\t\t\t\tanimation: spinner_T6mA 0.75s step-end infinite;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t@keyframes spinner_T6mA {\n\t\t\t\t\t\t\t8.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(30deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t16.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(60deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t25% {\n\t\t\t\t\t\t\t\ttransform: rotate(90deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t33.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(120deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t41.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(150deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t50% {\n\t\t\t\t\t\t\t\ttransform: rotate(180deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t58.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(210deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t66.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(240deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t75% {\n\t\t\t\t\t\t\t\ttransform: rotate(270deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t83.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(300deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t91.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(330deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\ttransform: rotate(360deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t</style><g class=\"spinner_OSmW\"\n\t\t\t\t\t\t><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" opacity=\".14\" /><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(30 12 12)\"\n\t\t\t\t\t\t\topacity=\".29\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(60 12 12)\"\n\t\t\t\t\t\t\topacity=\".43\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(90 12 12)\"\n\t\t\t\t\t\t\topacity=\".57\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(120 12 12)\"\n\t\t\t\t\t\t\topacity=\".71\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(150 12 12)\"\n\t\t\t\t\t\t\topacity=\".86\"\n\t\t\t\t\t\t/><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" transform=\"rotate(180 12 12)\" /></g\n\t\t\t\t\t></svg\n\t\t\t\t>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"p-1.5 bg-indigo-500 text-white dark:bg-indigo-500 dark:text-blue-950 rounded-full\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait confirmRecording();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m4.5 12.75 6 6 9-13.5\" />\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t.visualizer {\n\t\tdisplay: flex;\n\t\theight: 100%;\n\t}\n\n\t.visualizer-bar {\n\t\twidth: 2px;\n\t\tbackground-color: #4a5aba; /* or whatever color you need */\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { showSidebar } from '$lib/stores';\n\timport AddFilesPlaceholder from '$lib/components/AddFilesPlaceholder.svelte';\n\n\texport let show = false;\n\tlet overlayElement = null;\n\n\t$: if (show && overlayElement) {\n\t\tdocument.body.appendChild(overlayElement);\n\t\tdocument.body.style.overflow = 'hidden';\n\t} else if (overlayElement) {\n\t\tdocument.body.removeChild(overlayElement);\n\t\tdocument.body.style.overflow = 'unset';\n\t}\n</script>\n\n{#if show}\n\t<div\n\t\tbind:this={overlayElement}\n\t\tclass=\"fixed {$showSidebar\n\t\t\t? 'left-0 md:left-[260px] md:w-[calc(100%-260px)]'\n\t\t\t: 'left-0'}  fixed top-0 right-0 bottom-0 w-full h-full flex z-[9999] touch-none pointer-events-none\"\n\t\tid=\"dropzone\"\n\t\trole=\"region\"\n\t\taria-label=\"Drag and Drop Container\"\n\t>\n\t\t<div class=\"absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center\">\n\t\t\t<div class=\"m-auto pt-64 flex flex-col justify-center\">\n\t\t\t\t<div class=\"max-w-md\">\n\t\t\t\t\t<AddFilesPlaceholder />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { prompts } from '$lib/stores';\n\timport { findWordIndices } from '$lib/utils';\n\timport { tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\texport let files;\n\n\texport let prompt = '';\n\texport let command = '';\n\n\tlet selectedPromptIdx = 0;\n\tlet filteredPrompts = [];\n\n\t$: filteredPrompts = $prompts\n\t\t.filter((p) => p.command.toLowerCase().includes(command.toLowerCase()))\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\n\n\t$: if (command) {\n\t\tselectedPromptIdx = 0;\n\t}\n\n\texport const selectUp = () => {\n\t\tselectedPromptIdx = Math.max(0, selectedPromptIdx - 1);\n\t};\n\n\texport const selectDown = () => {\n\t\tselectedPromptIdx = Math.min(selectedPromptIdx + 1, filteredPrompts.length - 1);\n\t};\n\n\tconst confirmPrompt = async (command) => {\n\t\tlet text = command.content;\n\n\t\tif (command.content.includes('{{CLIPBOARD}}')) {\n\t\t\tconst clipboardText = await navigator.clipboard.readText().catch((err) => {\n\t\t\t\ttoast.error($i18n.t('Failed to read clipboard contents'));\n\t\t\t\treturn '{{CLIPBOARD}}';\n\t\t\t});\n\n\t\t\tconsole.log(clipboardText);\n\n\t\t\tconst clipboardItems = await navigator.clipboard.read();\n\n\t\t\tlet imageUrl = null;\n\t\t\tfor (const item of clipboardItems) {\n\t\t\t\t// Check for known image types\n\t\t\t\tfor (const type of item.types) {\n\t\t\t\t\tif (type.startsWith('image/')) {\n\t\t\t\t\t\tconst blob = await item.getType(type);\n\t\t\t\t\t\timageUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\tconsole.log(`Image URL (${type}): ${imageUrl}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (imageUrl) {\n\t\t\t\tfiles = [\n\t\t\t\t\t...files,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\ttext = command.content.replaceAll('{{CLIPBOARD}}', clipboardText);\n\t\t}\n\n\t\tprompt = text;\n\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\n\t\tchatInputElement.style.height = '';\n\t\tchatInputElement.style.height = Math.min(chatInputElement.scrollHeight, 200) + 'px';\n\n\t\tchatInputElement?.focus();\n\n\t\tawait tick();\n\n\t\tconst words = findWordIndices(prompt);\n\t\tif (words.length > 0) {\n\t\t\tconst word = words.at(0);\n\t\t\tchatInputElement.setSelectionRange(word?.startIndex, word.endIndex + 1);\n\t\t}\n\t};\n</script>\n\n{#if filteredPrompts.length > 0}\n\t<div\n\t\tid=\"commands-container\"\n\t\tclass=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0 z-10\"\n\t>\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\n\t\t\t<div class=\"  bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">/</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100\"\n\t\t\t>\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden\">\n\t\t\t\t\t{#each filteredPrompts as prompt, promptIdx}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {promptIdx === selectedPromptIdx\n\t\t\t\t\t\t\t\t? '  bg-gray-50 dark:bg-gray-850 selected-command-option-button'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconfirmPrompt(prompt);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\t\tselectedPromptIdx = promptIdx;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:focus={() => {}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100\">\n\t\t\t\t\t\t\t\t{prompt.command}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100\">\n\t\t\t\t\t\t\t\t{prompt.title}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\" px-2 pb-1 text-xs text-gray-600 dark:text-gray-100 bg-white dark:bg-gray-900 rounded-br-xl flex items-center space-x-1\"\n\t\t\t\t>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"w-3 h-3\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\td=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"line-clamp-1\">\n\t\t\t\t\t\t{$i18n.t(\n\t\t\t\t\t\t\t'Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.'\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher } from 'svelte';\n\n\timport { documents } from '$lib/stores';\n\timport { removeLastWordFromString, isValidHttpUrl } from '$lib/utils';\n\timport { tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\texport let prompt = '';\n\texport let command = '';\n\n\tconst dispatch = createEventDispatcher();\n\tlet selectedIdx = 0;\n\n\tlet filteredItems = [];\n\tlet filteredDocs = [];\n\n\tlet collections = [];\n\n\t$: collections = [\n\t\t...($documents.length > 0\n\t\t\t? [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'All Documents',\n\t\t\t\t\t\ttype: 'collection',\n\t\t\t\t\t\ttitle: $i18n.t('All Documents'),\n\t\t\t\t\t\tcollection_names: $documents.map((doc) => doc.collection_name)\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t: []),\n\t\t...$documents\n\t\t\t.reduce((a, e, i, arr) => {\n\t\t\t\treturn [...new Set([...a, ...(e?.content?.tags ?? []).map((tag) => tag.name)])];\n\t\t\t}, [])\n\t\t\t.map((tag) => ({\n\t\t\t\tname: tag,\n\t\t\t\ttype: 'collection',\n\t\t\t\tcollection_names: $documents\n\t\t\t\t\t.filter((doc) => (doc?.content?.tags ?? []).map((tag) => tag.name).includes(tag))\n\t\t\t\t\t.map((doc) => doc.collection_name)\n\t\t\t}))\n\t];\n\n\t$: filteredCollections = collections\n\t\t.filter((collection) => findByName(collection, command))\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\n\n\t$: filteredDocs = $documents\n\t\t.filter((doc) => findByName(doc, command))\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\n\n\t$: filteredItems = [...filteredCollections, ...filteredDocs];\n\n\t$: if (command) {\n\t\tselectedIdx = 0;\n\n\t\tconsole.log(filteredCollections);\n\t}\n\n\ttype ObjectWithName = {\n\t\tname: string;\n\t};\n\n\tconst findByName = (obj: ObjectWithName, command: string) => {\n\t\tconst name = obj.name.toLowerCase();\n\t\treturn name.includes(command.toLowerCase().split(' ')?.at(0)?.substring(1) ?? '');\n\t};\n\n\texport const selectUp = () => {\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\n\t};\n\n\texport const selectDown = () => {\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredItems.length - 1);\n\t};\n\n\tconst confirmSelect = async (doc) => {\n\t\tdispatch('select', doc);\n\n\t\tprompt = removeLastWordFromString(prompt, command);\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t};\n\n\tconst confirmSelectWeb = async (url) => {\n\t\tdispatch('url', url);\n\n\t\tprompt = removeLastWordFromString(prompt, command);\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t};\n\n\tconst confirmSelectYoutube = async (url) => {\n\t\tdispatch('youtube', url);\n\n\t\tprompt = removeLastWordFromString(prompt, command);\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t};\n</script>\n\n{#if filteredItems.length > 0 || prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\n\t<div\n\t\tid=\"commands-container\"\n\t\tclass=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0 z-10\"\n\t>\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\n\t\t\t<div class=\" bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">#</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-xl bg-white dark:bg-gray-900 dark:text-gray-100\"\n\t\t\t>\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5 scrollbar-hidden\">\n\t\t\t\t\t{#each filteredItems as doc, docIdx}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {docIdx === selectedIdx\n\t\t\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconsole.log(doc);\n\n\t\t\t\t\t\t\t\tconfirmSelect(doc);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\t\tselectedIdx = docIdx;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:focus={() => {}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if doc.type === 'collection'}\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{doc?.title ?? `#${doc.name}`}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Collection')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t#{doc.name} ({doc.filename})\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{doc.title}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\n\t\t\t\t\t{#if prompt\n\t\t\t\t\t\t.split(' ')\n\t\t\t\t\t\t.some((s) => s.substring(1).startsWith('https://www.youtube.com') || s\n\t\t\t\t\t\t\t\t\t.substring(1)\n\t\t\t\t\t\t\t\t\t.startsWith('https://youtu.be'))}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\n\t\t\t\t\t\t\t\t\tconfirmSelectYoutube(url);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Youtube')}</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{:else if prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\n\t\t\t\t\t\t\t\t\tconfirmSelectWeb(url);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Web')}</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher, onMount } from 'svelte';\n\timport { tick, getContext } from 'svelte';\n\n\timport { models } from '$lib/stores';\n\n\tconst i18n = getContext('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let command = '';\n\n\tlet selectedIdx = 0;\n\tlet filteredModels = [];\n\n\t$: filteredModels = $models\n\t\t.filter((p) =>\n\t\t\tp.name.toLowerCase().includes(command.toLowerCase().split(' ')?.at(0)?.substring(1) ?? '')\n\t\t)\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\n\n\t$: if (command) {\n\t\tselectedIdx = 0;\n\t}\n\n\texport const selectUp = () => {\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\n\t};\n\n\texport const selectDown = () => {\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredModels.length - 1);\n\t};\n\n\tconst confirmSelect = async (model) => {\n\t\tcommand = '';\n\t\tdispatch('select', model);\n\t};\n\n\tonMount(async () => {\n\t\tawait tick();\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t});\n</script>\n\n{#if filteredModels.length > 0}\n\t<div\n\t\tid=\"commands-container\"\n\t\tclass=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0 z-10\"\n\t>\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\n\t\t\t<div class=\" bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">@</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100\"\n\t\t\t>\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden\">\n\t\t\t\t\t{#each filteredModels as model, modelIdx}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left {modelIdx === selectedIdx\n\t\t\t\t\t\t\t\t? 'bg-gray-50 dark:bg-gray-850 selected-command-option-button'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconfirmSelect(model);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\t\tselectedIdx = modelIdx;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:focus={() => {}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tsrc={model?.info?.meta?.profile_image_url ?? '/static/13-Copy.png'}\n\t\t\t\t\t\t\t\t\talt={model?.name ?? model.id}\n\t\t\t\t\t\t\t\t\tclass=\"rounded-full size-6 items-center mr-2\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{model.name}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script>\n\timport { createEventDispatcher } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport Prompts from './Commands/Prompts.svelte';\n\timport Documents from './Commands/Documents.svelte';\n\timport Models from './Commands/Models.svelte';\n\n\timport { removeLastWordFromString } from '$lib/utils';\n\timport { uploadWebToVectorDB, uploadYoutubeTranscriptionToVectorDB } from '$lib/apis/rag';\n\n\texport let prompt = '';\n\texport let files = [];\n\n\tlet commandElement = null;\n\n\texport const selectUp = () => {\n\t\tcommandElement?.selectUp();\n\t};\n\n\texport const selectDown = () => {\n\t\tcommandElement?.selectDown();\n\t};\n\n\tlet command = '';\n\t$: command = (prompt?.trim() ?? '').split(' ')?.at(-1) ?? '';\n\n\tconst uploadWeb = async (url) => {\n\t\tconsole.log(url);\n\n\t\tconst doc = {\n\t\t\ttype: 'doc',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tstatus: false,\n\t\t\turl: url,\n\t\t\terror: ''\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, doc];\n\t\t\tconst res = await uploadWebToVectorDB(localStorage.token, '', url);\n\n\t\t\tif (res) {\n\t\t\t\tdoc.status = 'processed';\n\t\t\t\tdoc.collection_name = res.collection_name;\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\ttoast.error(e);\n\t\t}\n\t};\n\n\tconst uploadYoutubeTranscription = async (url) => {\n\t\tconsole.log(url);\n\n\t\tconst doc = {\n\t\t\ttype: 'doc',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tstatus: false,\n\t\t\turl: url,\n\t\t\terror: ''\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, doc];\n\t\t\tconst res = await uploadYoutubeTranscriptionToVectorDB(localStorage.token, url);\n\n\t\t\tif (res) {\n\t\t\t\tdoc.status = 'processed';\n\t\t\t\tdoc.collection_name = res.collection_name;\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\ttoast.error(e);\n\t\t}\n\t};\n</script>\n\n{#if ['/', '#', '@'].includes(command?.charAt(0))}\n\t{#if command?.charAt(0) === '/'}\n\t\t<Prompts bind:this={commandElement} bind:prompt bind:files {command} />\n\t{:else if command?.charAt(0) === '#'}\n\t\t<Documents\n\t\t\tbind:this={commandElement}\n\t\t\tbind:prompt\n\t\t\t{command}\n\t\t\ton:youtube={(e) => {\n\t\t\t\tconsole.log(e);\n\t\t\t\tuploadYoutubeTranscription(e.detail);\n\t\t\t}}\n\t\t\ton:url={(e) => {\n\t\t\t\tconsole.log(e);\n\t\t\t\tuploadWeb(e.detail);\n\t\t\t}}\n\t\t\ton:select={(e) => {\n\t\t\t\tconsole.log(e);\n\t\t\t\tfiles = [\n\t\t\t\t\t...files,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: e?.detail?.type ?? 'file',\n\t\t\t\t\t\t...e.detail,\n\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tdispatch('select');\n\t\t\t}}\n\t\t/>\n\t{:else if command?.charAt(0) === '@'}\n\t\t<Models\n\t\t\tbind:this={commandElement}\n\t\t\t{command}\n\t\t\ton:select={(e) => {\n\t\t\t\tprompt = removeLastWordFromString(prompt, command);\n\n\t\t\t\tdispatch('select', {\n\t\t\t\t\ttype: 'model',\n\t\t\t\t\tdata: e.detail\n\t\t\t\t});\n\t\t\t}}\n\t\t/>\n\t{/if}\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'size-3.5';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { onMount, tick, getContext, createEventDispatcher } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\n\timport {\n\t\ttype Model,\n\t\tmobile,\n\t\tsettings,\n\t\tshowSidebar,\n\t\tmodels,\n\t\tconfig,\n\t\tshowCallOverlay,\n\t\ttools,\n\t\tuser as _user\n\t} from '$lib/stores';\n\timport { blobToFile, findWordIndices } from '$lib/utils';\n\n\timport { transcribeAudio } from '$lib/apis/audio';\n\timport { processDocToVectorDB } from '$lib/apis/rag';\n\timport { uploadFile } from '$lib/apis/files';\n\n\timport {\n\t\tSUPPORTED_FILE_TYPE,\n\t\tSUPPORTED_FILE_EXTENSIONS,\n\t\tWEBUI_BASE_URL,\n\t\tWEBUI_API_BASE_URL\n\t} from '$lib/constants';\n\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport InputMenu from './MessageInput/InputMenu.svelte';\n\timport Headphone from '../icons/Headphone.svelte';\n\timport VoiceRecording from './MessageInput/VoiceRecording.svelte';\n\timport FileItem from '../common/FileItem.svelte';\n\timport FilesOverlay from './MessageInput/FilesOverlay.svelte';\n\timport Commands from './MessageInput/Commands.svelte';\n\timport XMark from '../icons/XMark.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let transparentBackground = false;\n\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\n\texport let autoScroll = false;\n\n\texport let atSelectedModel: Model | undefined;\n\texport let selectedModels: [''];\n\n\tlet recording = false;\n\n\tlet chatTextAreaElement: HTMLTextAreaElement;\n\tlet filesInputElement;\n\n\tlet commandsElement;\n\n\tlet inputFiles;\n\tlet dragged = false;\n\n\tlet user = null;\n\tlet chatInputPlaceholder = '';\n\n\texport let files = [];\n\n\texport let availableToolIds = [];\n\texport let selectedToolIds = [];\n\texport let webSearchEnabled = false;\n\n\texport let prompt = '';\n\texport let messages = [];\n\n\tlet visionCapableModels = [];\n\t$: visionCapableModels = [...(atSelectedModel ? [atSelectedModel] : selectedModels)].filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.vision ?? true\n\t);\n\n\t$: if (prompt) {\n\t\tif (chatTextAreaElement) {\n\t\t\tchatTextAreaElement.style.height = '';\n\t\t\tchatTextAreaElement.style.height = Math.min(chatTextAreaElement.scrollHeight, 200) + 'px';\n\t\t}\n\t}\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTo({\n\t\t\ttop: element.scrollHeight,\n\t\t\tbehavior: 'smooth'\n\t\t});\n\t};\n\n\tconst uploadFileHandler = async (file) => {\n\t\tconsole.log(file);\n\n\t\t// Check if the file is an audio file and transcribe/convert it to text file\n\t\tif (['audio/mpeg', 'audio/wav'].includes(file['type'])) {\n\t\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\n\t\t\t\ttoast.error(error);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tif (res) {\n\t\t\t\tconsole.log(res);\n\t\t\t\tconst blob = new Blob([res.text], { type: 'text/plain' });\n\t\t\t\tfile = blobToFile(blob, `${file.name}.txt`);\n\t\t\t}\n\t\t}\n\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: '',\n\t\t\tname: file.name,\n\t\t\tcollection_name: '',\n\t\t\tstatus: '',\n\t\t\tsize: file.size,\n\t\t\terror: ''\n\t\t};\n\t\tfiles = [...files, fileItem];\n\n\t\ttry {\n\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file);\n\n\t\t\tif (uploadedFile) {\n\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\tfileItem.file = uploadedFile;\n\t\t\t\tfileItem.id = uploadedFile.id;\n\t\t\t\tfileItem.url = `${WEBUI_API_BASE_URL}/files/${uploadedFile.id}`;\n\n\t\t\t\t// TODO: Check if tools & functions have files support to skip this step to delegate file processing\n\t\t\t\t// Default Upload to VectorDB\n\t\t\t\tif (\n\t\t\t\t\tSUPPORTED_FILE_TYPE.includes(file['type']) ||\n\t\t\t\t\tSUPPORTED_FILE_EXTENSIONS.includes(file.name.split('.').at(-1))\n\t\t\t\t) {\n\t\t\t\t\tprocessFileItem(fileItem);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t$i18n.t(`Unknown file type '{{file_type}}'. Proceeding with the file upload anyway.`, {\n\t\t\t\t\t\t\tfile_type: file['type']\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t\tprocessFileItem(fileItem);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfiles = files.filter((item) => item.status !== null);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\ttoast.error(e);\n\t\t\tfiles = files.filter((item) => item.status !== null);\n\t\t}\n\t};\n\n\tconst processFileItem = async (fileItem) => {\n\t\ttry {\n\t\t\tconst res = await processDocToVectorDB(localStorage.token, fileItem.id);\n\n\t\t\tif (res) {\n\t\t\t\tfileItem.status = 'processed';\n\t\t\t\tfileItem.collection_name = res.collection_name;\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\t// files = files.filter((f) => f.id !== fileItem.id);\n\t\t\ttoast.error(e);\n\t\t\tfileItem.status = 'processed';\n\t\t\tfiles = files;\n\t\t}\n\t};\n\n\tconst inputFilesHandler = async (inputFiles) => {\n\t\tinputFiles.forEach((file) => {\n\t\t\tconsole.log(file, file.name.split('.').at(-1));\n\n\t\t\tif (\n\t\t\t\t($config?.file?.max_size ?? null) !== null &&\n\t\t\t\tfile.size > ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t) {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`File size should not exceed {{maxSize}} MB.`, {\n\t\t\t\t\t\tmaxSize: $config?.file?.max_size\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (['image/gif', 'image/webp', 'image/jpeg', 'image/png'].includes(file['type'])) {\n\t\t\t\tif (visionCapableModels.length === 0) {\n\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet reader = new FileReader();\n\t\t\t\treader.onload = (event) => {\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t...files,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: `${event.target.result}`\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t};\n\t\t\t\treader.readAsDataURL(file);\n\t\t\t} else {\n\t\t\t\tuploadFileHandler(file);\n\t\t\t}\n\t\t});\n\t};\n\n\tonMount(() => {\n\t\twindow.setTimeout(() => chatTextAreaElement?.focus(), 0);\n\n\t\tconst dropZone = document.querySelector('body');\n\n\t\tconst handleKeyDown = (event: KeyboardEvent) => {\n\t\t\tif (event.key === 'Escape') {\n\t\t\t\tconsole.log('Escape');\n\t\t\t\tdragged = false;\n\t\t\t}\n\t\t};\n\n\t\tconst onDragOver = (e) => {\n\t\t\te.preventDefault();\n\t\t\tdragged = true;\n\t\t};\n\n\t\tconst onDragLeave = () => {\n\t\t\tdragged = false;\n\t\t};\n\n\t\tconst onDrop = async (e) => {\n\t\t\te.preventDefault();\n\t\t\tconsole.log(e);\n\n\t\t\tif (e.dataTransfer?.files) {\n\t\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\n\t\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\t\tconsole.log(inputFiles);\n\t\t\t\t\tinputFilesHandler(inputFiles);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdragged = false;\n\t\t};\n\n\t\twindow.addEventListener('keydown', handleKeyDown);\n\n\t\tdropZone?.addEventListener('dragover', onDragOver);\n\t\tdropZone?.addEventListener('drop', onDrop);\n\t\tdropZone?.addEventListener('dragleave', onDragLeave);\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener('keydown', handleKeyDown);\n\n\t\t\tdropZone?.removeEventListener('dragover', onDragOver);\n\t\t\tdropZone?.removeEventListener('drop', onDrop);\n\t\t\tdropZone?.removeEventListener('dragleave', onDragLeave);\n\t\t};\n\t});\n</script>\n\n<FilesOverlay show={dragged} />\n\n<div class=\"w-full font-primary\">\n\t<div class=\" -mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center\">\n\t\t<div class=\"flex flex-col max-w-6xl px-2.5 md:px-6 w-full\">\n\t\t\t<div class=\"relative\">\n\t\t\t\t{#if autoScroll === false && messages.length > 0}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tautoScroll = true;\n\t\t\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div class=\"w-full relative\">\n\t\t\t\t{#if atSelectedModel !== undefined}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0.5 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900 z-10\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center gap-2 text-sm dark:text-gray-500\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tcrossorigin=\"anonymous\"\n\t\t\t\t\t\t\t\talt=\"model profile\"\n\t\t\t\t\t\t\t\tclass=\"size-5 max-w-[28px] object-cover rounded-full\"\n\t\t\t\t\t\t\t\tsrc={$models.find((model) => model.id === atSelectedModel.id)?.info?.meta\n\t\t\t\t\t\t\t\t\t?.profile_image_url ??\n\t\t\t\t\t\t\t\t\t($i18n.language === 'dg-DG'\n\t\t\t\t\t\t\t\t\t\t? `/doge.png`\n\t\t\t\t\t\t\t\t\t\t: `${WEBUI_BASE_URL}/static/13-Copy.png`)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\tTalking to <span class=\" font-medium\">{atSelectedModel.name}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex items-center\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<XMark />\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<Commands\n\t\t\t\t\tbind:this={commandsElement}\n\t\t\t\t\tbind:prompt\n\t\t\t\t\tbind:files\n\t\t\t\t\ton:select={(e) => {\n\t\t\t\t\t\tconst data = e.detail;\n\n\t\t\t\t\t\tif (data?.type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data.data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tchatTextAreaElement?.focus();\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"{transparentBackground ? 'bg-transparent' : 'bg-white dark:bg-gray-900'} \">\n\t\t<div class=\"max-w-6xl px-2.5 md:px-6 mx-auto inset-x-0\">\n\t\t\t<div class=\" pb-2\">\n\t\t\t\t<input\n\t\t\t\t\tbind:this={filesInputElement}\n\t\t\t\t\tbind:files={inputFiles}\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\thidden\n\t\t\t\t\tmultiple\n\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\t\t\t\tconst _inputFiles = Array.from(inputFiles);\n\t\t\t\t\t\t\tinputFilesHandler(_inputFiles);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfilesInputElement.value = '';\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t{#if recording}\n\t\t\t\t\t<VoiceRecording\n\t\t\t\t\t\tbind:recording\n\t\t\t\t\t\ton:cancel={async () => {\n\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:confirm={async (e) => {\n\t\t\t\t\t\t\tconst response = e.detail;\n\t\t\t\t\t\t\tprompt = `${prompt}${response} `;\n\n\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\n\n\t\t\t\t\t\t\tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t{:else}\n\t\t\t\t\t<form\n\t\t\t\t\t\tclass=\"w-full flex gap-1.5\"\n\t\t\t\t\t\ton:submit|preventDefault={() => {\n\t\t\t\t\t\t\t// check if selectedModels support image input\n\t\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex-1 flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100\"\n\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'LTR'}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if files.length > 0}\n\t\t\t\t\t\t\t\t<div class=\"mx-1 mt-2.5 mb-1 flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t\t{#each files as file, fileIdx}\n\t\t\t\t\t\t\t\t\t\t{#if file.type === 'image'}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" relative group\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={file.url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"input\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" h-16 w-16 rounded-xl object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if atSelectedModel ? visionCapableModels.length === 0 : selectedModels.length !== visionCapableModels.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\" absolute top-1 left-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{ models }}', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels: [...(atSelectedModel ? [atSelectedModel] : selectedModels)]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter((id) => !visionCapableModels.includes(id))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(', ')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4 fill-yellow-300\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" absolute -top-1 -right-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\t\t\t\tstatus={file.status}\n\t\t\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\t\t\ton:dismiss={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<div class=\" flex\">\n\t\t\t\t\t\t\t\t<div class=\" ml-0.5 self-end mb-1.5 flex space-x-1\">\n\t\t\t\t\t\t\t\t\t<InputMenu\n\t\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\t\ttools={$tools.reduce((a, e, i, arr) => {\n\t\t\t\t\t\t\t\t\t\t\tif (availableToolIds.includes(e.id) || ($_user?.role ?? 'user') === 'admin') {\n\t\t\t\t\t\t\t\t\t\t\t\ta[e.id] = {\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: e.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: e.meta.description,\n\t\t\t\t\t\t\t\t\t\t\t\t\tenabled: false\n\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t\t\t\t\t}, {})}\n\t\t\t\t\t\t\t\t\t\tuploadFilesHandler={() => {\n\t\t\t\t\t\t\t\t\t\t\tfilesInputElement.click();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tonClose={async () => {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\tchatTextAreaElement?.focus();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-2 outline-none focus:outline-none\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\taria-label=\"More\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</InputMenu>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tid=\"chat-textarea\"\n\t\t\t\t\t\t\t\t\tbind:this={chatTextAreaElement}\n\t\t\t\t\t\t\t\t\tclass=\"scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-1 rounded-xl resize-none h-[48px]\"\n\t\t\t\t\t\t\t\t\tplaceholder={chatInputPlaceholder !== ''\n\t\t\t\t\t\t\t\t\t\t? chatInputPlaceholder\n\t\t\t\t\t\t\t\t\t\t: $i18n.t('Send a Message')}\n\t\t\t\t\t\t\t\t\tbind:value={prompt}\n\t\t\t\t\t\t\t\t\ton:keypress={(e) => {\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t!$mobile ||\n\t\t\t\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\n\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\t// Prevent Enter key from creating a new line\n\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter' && !e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t// Submit the prompt when Enter key is pressed\n\t\t\t\t\t\t\t\t\t\t\tif (prompt !== '' && e.key === 'Enter' && !e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:keydown={async (e) => {\n\t\t\t\t\t\t\t\t\t\tconst isCtrlPressed = e.ctrlKey || e.metaKey; // metaKey is for Cmd key on Mac\n\t\t\t\t\t\t\t\t\t\tconst commandsContainerElement = document.getElementById('commands-container');\n\n\t\t\t\t\t\t\t\t\t\t// Check if Ctrl + R is pressed\n\t\t\t\t\t\t\t\t\t\tif (prompt === '' && isCtrlPressed && e.key.toLowerCase() === 'r') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('regenerate');\n\n\t\t\t\t\t\t\t\t\t\t\tconst regenerateButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('regenerate-response-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tregenerateButton?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (prompt === '' && e.key == 'ArrowUp') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\tconst userMessageElement = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('user-message')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tconst editButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('edit-user-message-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(userMessageElement);\n\n\t\t\t\t\t\t\t\t\t\t\tuserMessageElement.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t\teditButton?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (commandsContainerElement && e.key === 'ArrowUp') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tcommandsElement.selectUp();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (commandsContainerElement && e.key === 'ArrowDown') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tcommandsElement.selectDown();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (commandsContainerElement && e.key === 'Enter') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = `${prompt}\\n`;\n\t\t\t\t\t\t\t\t\t\t\t} else if (commandOptionButton) {\n\t\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('send-message-button')?.click();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (commandsContainerElement && e.key === 'Tab') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\n\t\t\t\t\t\t\t\t\t\t} else if (e.key === 'Tab') {\n\t\t\t\t\t\t\t\t\t\t\tconst words = findWordIndices(prompt);\n\n\t\t\t\t\t\t\t\t\t\t\tif (words.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tconst word = words.at(0);\n\t\t\t\t\t\t\t\t\t\t\t\tconst fullPrompt = prompt;\n\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = prompt.substring(0, word?.endIndex + 1);\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\te.target.scrollTop = e.target.scrollHeight;\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = fullPrompt;\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\te.target.setSelectionRange(word?.startIndex, word.endIndex + 1);\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('Escape');\n\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\trows=\"1\"\n\t\t\t\t\t\t\t\t\ton:input={async (e) => {\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\n\t\t\t\t\t\t\t\t\t\tuser = null;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:focus={async (e) => {\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:paste={async (e) => {\n\t\t\t\t\t\t\t\t\t\tconst clipboardData = e.clipboardData || window.clipboardData;\n\n\t\t\t\t\t\t\t\t\t\tif (clipboardData && clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\tfor (const item of clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (item.type.indexOf('image') !== -1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst blob = item.getAsFile();\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst reader = new FileReader();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treader.onload = function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: `${e.target.result}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treader.readAsDataURL(blob);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<div class=\"self-end mb-2 flex space-x-1 mr-1\">\n\t\t\t\t\t\t\t\t\t{#if messages.length == 0 || messages.at(-1).done == true}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Record voice')}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"voice-input-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(function (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Permission denied when accessing microphone: {{error}}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trecording = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Voice Input\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5 translate-y-[0.5px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-end w-10\">\n\t\t\t\t\t\t\t{#if messages.length == 0 || messages.at(-1).done == true}\n\t\t\t\t\t\t\t\t{#if prompt === ''}\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Call')}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-2 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModels.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Select only one model to call'));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ($config.audio.stt.engine === 'web') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Call feature is not supported when using Web STT engine')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// check if user has access to getUserMedia\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user grants the permission, proceed to show the call overlay\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowCallOverlay.set(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('call');\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user denies the permission or an error occurs, show an error message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing media devices'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Call\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Headphone className=\"size-6\" />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Send message')}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{prompt !== ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 m-0.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={prompt === ''}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1.5\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z\"\n\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"mt-1.5 text-xs text-gray-500 text-center line-clamp-1\">\n\t\t\t\t\t{$i18n.t('LLMs can make mistakes. Verify important information.')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.scrollbar-hidden:active::-webkit-scrollbar-thumb,\n\t.scrollbar-hidden:focus::-webkit-scrollbar-thumb,\n\t.scrollbar-hidden:hover::-webkit-scrollbar-thumb {\n\t\tvisibility: visible;\n\t}\n\t.scrollbar-hidden::-webkit-scrollbar-thumb {\n\t\tvisibility: hidden;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { models, showSettings, settings, user, mobile, config } from '$lib/stores';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\timport Selector from './ModelSelector/Selector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\n\timport { setDefaultModels } from '$lib/apis/configs';\n\timport { updateUserSettings } from '$lib/apis/users';\n\n\tconst i18n = getContext('i18n');\n\n\texport let selectedModels = [''];\n\texport let disabled = false;\n\n\texport let showSetDefault = true;\n\n\tconst saveDefaultModel = async () => {\n\t\tconst hasEmptyModel = selectedModels.filter((it) => it === '');\n\t\tif (hasEmptyModel.length) {\n\t\t\ttoast.error($i18n.t('Choose a model before saving...'));\n\t\t\treturn;\n\t\t}\n\t\tsettings.set({ ...$settings, models: selectedModels });\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\n\n\t\ttoast.success($i18n.t('Default model updated'));\n\t};\n\n\t$: if (selectedModels.length > 0 && $models.length > 0) {\n\t\tselectedModels = selectedModels.map((model) =>\n\t\t\t$models.map((m) => m.id).includes(model) ? model : ''\n\t\t);\n\t}\n</script>\n\n<div class=\"flex flex-col w-full items-start\">\n\t{#each selectedModels as selectedModel, selectedModelIdx}\n\t\t<div class=\"flex w-full max-w-fit\">\n\t\t\t<div class=\"overflow-hidden w-full\">\n\t\t\t\t<div class=\"mr-1 max-w-full\">\n\t\t\t\t\t<Selector\n\t\t\t\t\t\tplaceholder={$i18n.t('Select a model')}\n\t\t\t\t\t\titems={$models.map((model) => ({\n\t\t\t\t\t\t\tvalue: model.id,\n\t\t\t\t\t\t\tlabel: model.name,\n\t\t\t\t\t\t\tmodel: model\n\t\t\t\t\t\t}))}\n\t\t\t\t\t\tshowTemporaryChatControl={$user.role === 'user'\n\t\t\t\t\t\t\t? ($config?.permissions?.chat?.temporary ?? true)\n\t\t\t\t\t\t\t: true}\n\t\t\t\t\t\tbind:value={selectedModel}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if selectedModelIdx === 0}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\n\t\t\t\t>\n\t\t\t\t\t<Tooltip content={$i18n.t('Add Model')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" \"\n\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tselectedModels = [...selectedModels, ''];\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\taria-label=\"Add Model\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 6v12m6-6H6\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\n\t\t\t\t>\n\t\t\t\t\t<Tooltip content={$i18n.t('Remove Model')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tselectedModels.splice(selectedModelIdx, 1);\n\t\t\t\t\t\t\t\tselectedModels = selectedModels;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\taria-label=\"Remove Model\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-3\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12h-15\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t{/each}\n</div>\n\n{#if showSetDefault}\n\t<div class=\" absolute text-left mt-[1px] ml-1 text-[0.7rem] text-gray-500 font-primary\">\n\t\t<button on:click={saveDefaultModel}> {$i18n.t('Set as default')}</button>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext } from 'svelte';\n\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport { showSettings } from '$lib/stores';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tags from '$lib/components/chat/Tags.svelte';\n\n\timport { downloadChatAsPDF } from '$lib/apis/utils';\n\n\tconst i18n = getContext('i18n');\n\n\texport let shareEnabled: boolean = false;\n\texport let shareHandler: Function;\n\texport let downloadHandler: Function;\n\n\t// export let tagHandler: Function;\n\n\texport let chat;\n\texport let onClose: Function = () => {};\n\n\tconst downloadTxt = async () => {\n\t\tconst _chat = chat.chat;\n\t\tconsole.log('download', chat);\n\n\t\tconst chatText = _chat.messages.reduce((a, message, i, arr) => {\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\n\t\t}, '');\n\n\t\tlet blob = new Blob([chatText], {\n\t\t\ttype: 'text/plain'\n\t\t});\n\n\t\tsaveAs(blob, `chat-${_chat.title}.txt`);\n\t};\n\n\tconst downloadPdf = async () => {\n\t\tconst _chat = chat.chat;\n\t\tconsole.log('download', chat);\n\n\t\tconst blob = await downloadChatAsPDF(_chat);\n\n\t\t// Create a URL for the blob\n\t\tconst url = window.URL.createObjectURL(blob);\n\n\t\t// Create a link element to trigger the download\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `chat-${_chat.title}.pdf`;\n\n\t\t// Append the link to the body and click it programmatically\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\n\t\t// Remove the link from the body\n\t\tdocument.body.removeChild(a);\n\n\t\t// Revoke the URL to release memory\n\t\twindow.URL.revokeObjectURL(url);\n\t};\n\n\tconst downloadJSONExport = async () => {\n\t\tlet blob = new Blob([JSON.stringify([chat])], {\n\t\t\ttype: 'application/json'\n\t\t});\n\t\tsaveAs(blob, `chat-export-${Date.now()}.json`);\n\t};\n</script>\n\n<Dropdown\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\tsideOffset={8}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"end\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<!-- <DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showSettings.set(!$showSettings);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Settings')}</div>\n\t\t\t</DropdownMenu.Item> -->\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\tid=\"chat-share-button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshareHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\td=\"M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z\"\n\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Share')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t\t<!-- <DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdownloadHandler();\n\t\t\t\t\t}}\n\t\t\t\t/> -->\n\t\t\t<DropdownMenu.Sub>\n\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\td=\"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Download')}</div>\n\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\tclass=\"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t>\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadJSONExport();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Export chat (.json)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadTxt();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Plain text (.txt)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadPdf();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('PDF document (.pdf)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t</DropdownMenu.Sub>\n\n\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5\" />\n\n\t\t\t<div class=\"flex p-1\">\n\t\t\t\t<Tags chatId={chat.id} />\n\t\t\t</div>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tviewBox=\"0 0 24 24\"\n\tstroke=\"currentColor\"\n\tfill=\"currentColor\"\n\tclass={className}\n\tstroke-width={strokeWidth}\n>\n\t<path\n\t\td=\"M18.75 12.75h1.5a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM12 6a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 6ZM12 18a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 18ZM3.75 6.75h1.5a.75.75 0 1 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM5.25 18.75h-1.5a.75.75 0 0 1 0-1.5h1.5a.75.75 0 0 1 0 1.5ZM3 12a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 3 12ZM9 3.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5ZM12.75 12a2.25 2.25 0 1 1 4.5 0 2.25 2.25 0 0 1-4.5 0ZM9 15.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\timport {\n\t\tWEBUI_NAME,\n\t\tchatId,\n\t\tmobile,\n\t\tsettings,\n\t\tshowArchivedChats,\n\t\tshowSettings,\n\t\tshowSidebar,\n\t\tuser\n\t} from '$lib/stores';\n\n\timport { slide } from 'svelte/transition';\n\timport ShareChatModal from '../chat/ShareChatModal.svelte';\n\timport ModelSelector from '../chat/ModelSelector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Menu from './Navbar/Menu.svelte';\n\timport { page } from '$app/stores';\n\timport UserMenu from './Sidebar/UserMenu.svelte';\n\timport MenuLines from '../icons/MenuLines.svelte';\n\timport AdjustmentsHorizontal from '../icons/AdjustmentsHorizontal.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let initNewChat: Function;\n\texport let title: string = $WEBUI_NAME;\n\texport let shareEnabled: boolean = false;\n\n\texport let chat;\n\texport let selectedModels;\n\n\texport let showModelSelector = true;\n\texport let showControls = false;\n\n\tlet showShareChatModal = false;\n\tlet showDownloadChatModal = false;\n</script>\n\n<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />\n<nav id=\"nav\" class=\" sticky py-2.5 top-0 flex flex-row justify-center z-10\">\n\t<div class=\" flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]\">\n\t\t<div class=\"flex items-center w-full max-w-full\">\n\t\t\t<div\n\t\t\t\tclass=\"{$showSidebar\n\t\t\t\t\t? 'md:hidden'\n\t\t\t\t\t: ''} mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400\"\n\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tid=\"sidebar-toggle-button\"\n\t\t\t\t\tclass=\"cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowSidebar.set(!$showSidebar);\n\t\t\t\t\t}}\n\t\t\t\t\taria-label=\"Toggle Sidebar\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t<MenuLines />\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex-1 overflow-hidden max-w-full\">\n\t\t\t\t{#if showModelSelector}\n\t\t\t\t\t<ModelSelector bind:selectedModels showSetDefault={!shareEnabled} />\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div class=\"self-start flex flex-none items-center text-gray-600 dark:text-gray-400\">\n\t\t\t\t<!-- <div class=\"md:hidden flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700\" /> -->\n\n\t\t\t\t{#if shareEnabled && chat && chat.id}\n\t\t\t\t\t<Menu\n\t\t\t\t\t\t{chat}\n\t\t\t\t\t\t{shareEnabled}\n\t\t\t\t\t\tshareHandler={() => {\n\t\t\t\t\t\t\tshowShareChatModal = !showShareChatModal;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdownloadHandler={() => {\n\t\t\t\t\t\t\tshowDownloadChatModal = !showDownloadChatModal;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\tid=\"chat-context-menu-button\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Menu>\n\t\t\t\t{/if}\n\n\t\t\t\t<Tooltip content={$i18n.t('Controls')}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\" flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tshowControls = !showControls;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\taria-label=\"Controls\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t<AdjustmentsHorizontal className=\" size-5\" strokeWidth=\"0.5\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</Tooltip>\n\n\t\t\t\t<Tooltip content={$i18n.t('New Chat')}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tid=\"new-chat-button\"\n\t\t\t\t\t\tclass=\" flex {$showSidebar\n\t\t\t\t\t\t\t? 'md:hidden'\n\t\t\t\t\t\t\t: ''} cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tinitNewChat();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\taria-label=\"New Chat\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</Tooltip>\n\n\t\t\t\t{#if $user !== undefined}\n\t\t\t\t\t<UserMenu\n\t\t\t\t\t\tclassName=\"max-w-[200px]\"\n\t\t\t\t\t\trole={$user.role}\n\t\t\t\t\t\ton:show={(e) => {\n\t\t\t\t\t\t\tif (e.detail === 'archived-chat') {\n\t\t\t\t\t\t\t\tshowArchivedChats.set(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"select-none flex rounded-xl p-1.5 w-full hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\taria-label=\"User Menu\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" self-center\">\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tsrc={$user.profile_image_url}\n\t\t\t\t\t\t\t\t\tclass=\"size-6 object-cover rounded-full\"\n\t\t\t\t\t\t\t\t\talt=\"User profile\"\n\t\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</UserMenu>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</nav>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { config, functions, models, settings, tools, user } from '$lib/stores';\n\timport { createEventDispatcher, onMount, getContext, tick } from 'svelte';\n\n\timport {\n\t\tgetUserValvesSpecById as getToolUserValvesSpecById,\n\t\tgetUserValvesById as getToolUserValvesById,\n\t\tupdateUserValvesById as updateToolUserValvesById\n\t} from '$lib/apis/tools';\n\timport {\n\t\tgetUserValvesSpecById as getFunctionUserValvesSpecById,\n\t\tgetUserValvesById as getFunctionUserValvesById,\n\t\tupdateUserValvesById as updateFunctionUserValvesById\n\t} from '$lib/apis/functions';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Valves from '$lib/components/common/Valves.svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\tconst i18n = getContext('i18n');\n\n\tlet tab = 'tools';\n\tlet selectedId = '';\n\n\tlet loading = false;\n\n\tlet valvesSpec = null;\n\tlet valves = {};\n\n\tlet debounceTimer;\n\n\tconst debounceSubmitHandler = async () => {\n\t\tif (debounceTimer) {\n\t\t\tclearTimeout(debounceTimer);\n\t\t}\n\n\t\t// Set a new timer\n\t\tdebounceTimer = setTimeout(() => {\n\t\t\tsubmitHandler();\n\t\t}, 500); // 0.5 second debounce\n\t};\n\n\tconst getUserValves = async () => {\n\t\tloading = true;\n\t\tif (tab === 'tools') {\n\t\t\tvalves = await getToolUserValvesById(localStorage.token, selectedId);\n\t\t\tvalvesSpec = await getToolUserValvesSpecById(localStorage.token, selectedId);\n\t\t} else if (tab === 'functions') {\n\t\t\tvalves = await getFunctionUserValvesById(localStorage.token, selectedId);\n\t\t\tvalvesSpec = await getFunctionUserValvesSpecById(localStorage.token, selectedId);\n\t\t}\n\n\t\tif (valvesSpec) {\n\t\t\t// Convert array to string\n\t\t\tfor (const property in valvesSpec.properties) {\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\n\t\t\t\t\tvalves[property] = (valves[property] ?? []).join(',');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tloading = false;\n\t};\n\n\tconst submitHandler = async () => {\n\t\tif (valvesSpec) {\n\t\t\t// Convert string to array\n\t\t\tfor (const property in valvesSpec.properties) {\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\n\t\t\t\t\tvalves[property] = (valves[property] ?? '').split(',').map((v) => v.trim());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (tab === 'tools') {\n\t\t\t\tconst res = await updateToolUserValvesById(localStorage.token, selectedId, valves).catch(\n\t\t\t\t\t(error) => {\n\t\t\t\t\t\ttoast.error(error);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tif (res) {\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\n\t\t\t\t\tvalves = res;\n\t\t\t\t}\n\t\t\t} else if (tab === 'functions') {\n\t\t\t\tconst res = await updateFunctionUserValvesById(\n\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\tselectedId,\n\t\t\t\t\tvalves\n\t\t\t\t).catch((error) => {\n\t\t\t\t\ttoast.error(error);\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\n\t\t\t\tif (res) {\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\n\t\t\t\t\tvalves = res;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t$: if (tab) {\n\t\tselectedId = '';\n\t}\n\n\t$: if (selectedId) {\n\t\tgetUserValves();\n\t}\n</script>\n\n<form\n\tclass=\"flex flex-col h-full justify-between space-y-3 text-sm\"\n\ton:submit|preventDefault={() => {\n\t\tsubmitHandler();\n\t\tdispatch('save');\n\t}}\n>\n\t<div class=\"flex flex-col\">\n\t\t<div class=\"space-y-1\">\n\t\t\t<div class=\"flex gap-2\">\n\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t<select\n\t\t\t\t\t\tclass=\"  w-full rounded text-xs py-2 px-1 bg-transparent outline-none\"\n\t\t\t\t\t\tbind:value={tab}\n\t\t\t\t\t\tplaceholder=\"Select\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option value=\"tools\" class=\"bg-gray-100 dark:bg-gray-800\">{$i18n.t('Tools')}</option>\n\t\t\t\t\t\t<option value=\"functions\" class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t>{$i18n.t('Functions')}</option\n\t\t\t\t\t\t>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t<select\n\t\t\t\t\t\tclass=\"w-full rounded py-2 px-1 text-xs bg-transparent outline-none\"\n\t\t\t\t\t\tbind:value={selectedId}\n\t\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if tab === 'tools'}\n\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t>{$i18n.t('Select a tool')}</option\n\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t{#each $tools as tool, toolIdx}\n\t\t\t\t\t\t\t\t<option value={tool.id} class=\"bg-gray-100 dark:bg-gray-800\">{tool.name}</option>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t{:else if tab === 'functions'}\n\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t>{$i18n.t('Select a function')}</option\n\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t{#each $functions as func, funcIdx}\n\t\t\t\t\t\t\t\t<option value={func.id} class=\"bg-gray-100 dark:bg-gray-800\">{func.name}</option>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if selectedId}\n\t\t\t<hr class=\"dark:border-gray-800 my-1 w-full\" />\n\n\t\t\t<div class=\"my-2 text-xs\">\n\t\t\t\t{#if !loading}\n\t\t\t\t\t<Valves\n\t\t\t\t\t\t{valvesSpec}\n\t\t\t\t\t\tbind:valves\n\t\t\t\t\t\ton:change={() => {\n\t\t\t\t\t\t\tdebounceSubmitHandler();\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t{:else}\n\t\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</form>\n","<script lang=\"ts\">\n\timport { createEventDispatcher, getContext } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\tconst i18n = getContext('i18n');\n\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport AdvancedParams from '../Settings/Advanced/AdvancedParams.svelte';\n\timport Valves from '$lib/components/chat/Controls/Valves.svelte';\n\timport FileItem from '$lib/components/common/FileItem.svelte';\n\timport Collapsible from '$lib/components/common/Collapsible.svelte';\n\n\timport { user } from '$lib/stores';\n\texport let models = [];\n\texport let chatFiles = [];\n\texport let params = {};\n</script>\n\n<div class=\" dark:text-white\">\n\t<div class=\" flex justify-between dark:text-gray-100 mb-2\">\n\t\t<div class=\" text-lg font-medium self-center font-primary\">{$i18n.t('Chat Controls')}</div>\n\t\t<button\n\t\t\tclass=\"self-center\"\n\t\t\ton:click={() => {\n\t\t\t\tdispatch('close');\n\t\t\t}}\n\t\t>\n\t\t\t<XMark className=\"size-4\" />\n\t\t</button>\n\t</div>\n\n\t<div class=\" dark:text-gray-200 text-sm font-primary py-0.5\">\n\t\t{#if chatFiles.length > 0}\n\t\t\t<Collapsible title={$i18n.t('Files')} open={true}>\n\t\t\t\t<div class=\"flex flex-col gap-1 mt-1.5\" slot=\"content\">\n\t\t\t\t\t{#each chatFiles as file, fileIdx}\n\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\turl={`${file?.url}`}\n\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\ton:dismiss={() => {\n\t\t\t\t\t\t\t\t// Remove the file from the chatFiles array\n\n\t\t\t\t\t\t\t\tchatFiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\tchatFiles = chatFiles;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</Collapsible>\n\n\t\t\t<hr class=\"my-2 border-gray-100 dark:border-gray-800\" />\n\t\t{/if}\n\n\t\t<Collapsible title={$i18n.t('Valves')}>\n\t\t\t<div class=\"text-sm mt-1.5\" slot=\"content\">\n\t\t\t\t<Valves />\n\t\t\t</div>\n\t\t</Collapsible>\n\n\t\t<hr class=\"my-2 border-gray-100 dark:border-gray-800\" />\n\n\t\t<Collapsible title={$i18n.t('System Prompt')} open={true}>\n\t\t\t<div class=\" mt-1.5\" slot=\"content\">\n\t\t\t\t<textarea\n\t\t\t\t\tbind:value={params.system}\n\t\t\t\t\tclass=\"w-full rounded-lg px-3.5 py-2.5 text-sm dark:text-gray-300 dark:bg-gray-850 border border-gray-100 dark:border-gray-800 outline-none resize-none\"\n\t\t\t\t\trows=\"4\"\n\t\t\t\t\tplaceholder={$i18n.t('Enter system prompt')}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</Collapsible>\n\n\t\t<hr class=\"my-2 border-gray-100 dark:border-gray-800\" />\n\n\t\t<Collapsible title={$i18n.t('Advanced Params')} open={true}>\n\t\t\t<div class=\"text-sm mt-1.5\" slot=\"content\">\n\t\t\t\t<div>\n\t\t\t\t\t<AdvancedParams admin={$user?.role === 'admin'} bind:params />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Collapsible>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext, createEventDispatcher } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\n\texport let onClose: Function = () => {};\n\texport let devices: any;\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-[9999] bg-white dark:bg-gray-900 dark:text-white shadow-sm\"\n\t\t\tsideOffset={6}\n\t\t\tside=\"top\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#each devices as device}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('change', device.deviceId);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t{device?.label ?? 'Camera'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/each}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { config, models, settings, showCallOverlay } from '$lib/stores';\n\timport { onMount, tick, getContext, onDestroy, createEventDispatcher } from 'svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport {\n\t\tblobToFile,\n\t\tcalculateSHA256,\n\t\textractSentencesForAudio,\n\t\tfindWordIndices\n\t} from '$lib/utils';\n\timport { generateEmoji } from '$lib/apis';\n\timport { synthesizeOpenAISpeech, transcribeAudio } from '$lib/apis/audio';\n\n\timport { toast } from 'svelte-sonner';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport VideoInputMenu from './CallOverlay/VideoInputMenu.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let eventTarget: EventTarget;\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\texport let files;\n\texport let chatId;\n\texport let modelId;\n\n\tlet wakeLock = null;\n\n\tlet model = null;\n\n\tlet loading = false;\n\tlet confirmed = false;\n\tlet interrupted = false;\n\tlet assistantSpeaking = false;\n\n\tlet emoji = null;\n\n\tlet camera = false;\n\tlet cameraStream = null;\n\n\tlet chatStreaming = false;\n\n\tlet rmsLevel = 0;\n\tlet hasStartedSpeaking = false;\n\tlet mediaRecorder;\n\tlet audioStream = null;\n\tlet audioChunks = [];\n\n\tlet videoInputDevices = [];\n\tlet selectedVideoInputDeviceId = null;\n\n\tconst getVideoInputDevices = async () => {\n\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\t\tvideoInputDevices = devices.filter((device) => device.kind === 'videoinput');\n\n\t\tif (!!navigator.mediaDevices.getDisplayMedia) {\n\t\t\tvideoInputDevices = [\n\t\t\t\t...videoInputDevices,\n\t\t\t\t{\n\t\t\t\t\tdeviceId: 'screen',\n\t\t\t\t\tlabel: 'Screen Share'\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tconsole.log(videoInputDevices);\n\t\tif (selectedVideoInputDeviceId === null && videoInputDevices.length > 0) {\n\t\t\tselectedVideoInputDeviceId = videoInputDevices[0].deviceId;\n\t\t}\n\t};\n\n\tconst startCamera = async () => {\n\t\tawait getVideoInputDevices();\n\n\t\tif (cameraStream === null) {\n\t\t\tcamera = true;\n\t\t\tawait tick();\n\t\t\ttry {\n\t\t\t\tawait startVideoStream();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error accessing webcam: ', err);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst startVideoStream = async () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tif (video) {\n\t\t\tif (selectedVideoInputDeviceId === 'screen') {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always'\n\t\t\t\t\t},\n\t\t\t\t\taudio: false\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tdeviceId: selectedVideoInputDeviceId ? { exact: selectedVideoInputDeviceId } : undefined\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (cameraStream) {\n\t\t\t\tawait getVideoInputDevices();\n\t\t\t\tvideo.srcObject = cameraStream;\n\t\t\t\tawait video.play();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopVideoStream = async () => {\n\t\tif (cameraStream) {\n\t\t\tconst tracks = cameraStream.getTracks();\n\t\t\ttracks.forEach((track) => track.stop());\n\t\t}\n\n\t\tcameraStream = null;\n\t};\n\n\tconst takeScreenshot = () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tconst canvas = document.getElementById('camera-canvas');\n\n\t\tif (!canvas) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst context = canvas.getContext('2d');\n\n\t\t// Make the canvas match the video dimensions\n\t\tcanvas.width = video.videoWidth;\n\t\tcanvas.height = video.videoHeight;\n\n\t\t// Draw the image from the video onto the canvas\n\t\tcontext.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);\n\n\t\t// Convert the canvas to a data base64 URL and console log it\n\t\tconst dataURL = canvas.toDataURL('image/png');\n\t\tconsole.log(dataURL);\n\n\t\treturn dataURL;\n\t};\n\n\tconst stopCamera = async () => {\n\t\tawait stopVideoStream();\n\t\tcamera = false;\n\t};\n\n\tconst MIN_DECIBELS = -55;\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\n\n\tconst transcribeHandler = async (audioBlob) => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\n\n\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res.text);\n\n\t\t\tif (res.text !== '') {\n\t\t\t\tconst _responses = await submitPrompt(res.text, { _raw: true });\n\t\t\t\tconsole.log(_responses);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecordingCallback = async (_continue = true) => {\n\t\tif ($showCallOverlay) {\n\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', '🚨 stopRecordingCallback 🚨');\n\n\t\t\t// deep copy the audioChunks array\n\t\t\tconst _audioChunks = audioChunks.slice(0);\n\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (_continue) {\n\t\t\t\tstartRecording();\n\t\t\t}\n\n\t\t\tif (confirmed) {\n\t\t\t\tloading = true;\n\t\t\t\temoji = null;\n\n\t\t\t\tif (cameraStream) {\n\t\t\t\t\tconst imageUrl = takeScreenshot();\n\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tconst audioBlob = new Blob(_audioChunks, { type: 'audio/wav' });\n\t\t\t\tawait transcribeHandler(audioBlob);\n\n\t\t\t\tconfirmed = false;\n\t\t\t\tloading = false;\n\t\t\t}\n\t\t} else {\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (audioStream) {\n\t\t\t\tconst tracks = audioStream.getTracks();\n\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t}\n\t\t\taudioStream = null;\n\t\t}\n\t};\n\n\tconst startRecording = async () => {\n\t\taudioStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t\tmediaRecorder = new MediaRecorder(audioStream);\n\n\t\tmediaRecorder.onstart = () => {\n\t\t\tconsole.log('Recording started');\n\t\t\taudioChunks = [];\n\t\t\tanalyseAudio(audioStream);\n\t\t};\n\n\t\tmediaRecorder.ondataavailable = (event) => {\n\t\t\tif (hasStartedSpeaking) {\n\t\t\t\taudioChunks.push(event.data);\n\t\t\t}\n\t\t};\n\n\t\tmediaRecorder.onstop = (e) => {\n\t\t\tconsole.log('Recording stopped', e);\n\t\t\tstopRecordingCallback();\n\t\t};\n\n\t\tmediaRecorder.start();\n\t};\n\n\tconst stopAudioStream = async () => {\n\t\tif (audioStream) {\n\t\t\tconst tracks = audioStream.getTracks();\n\t\t\ttracks.forEach((track) => track.stop());\n\t\t}\n\n\t\taudioStream = null;\n\t};\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\t\thasStartedSpeaking = false;\n\n\t\tconsole.log('🔊 Sound detection started', lastSoundTime, hasStartedSpeaking);\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!mediaRecorder || !$showCallOverlay) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (assistantSpeaking && !($settings?.voiceInterruption ?? false)) {\n\t\t\t\t\t// Mute the audio if the assistant is speaking\n\t\t\t\t\tanalyser.maxDecibels = 0;\n\t\t\t\t\tanalyser.minDecibels = -1;\n\t\t\t\t} else {\n\t\t\t\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\t\t\t\tanalyser.maxDecibels = -30;\n\t\t\t\t}\n\n\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\trmsLevel = calculateRMS(timeDomainData);\n\n\t\t\t\t// Check if initial speech/noise has started\n\t\t\t\tconst hasSound = domainData.some((value) => value > 0);\n\t\t\t\tif (hasSound) {\n\t\t\t\t\t// BIG RED TEXT\n\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', '🔊 Sound detected');\n\n\t\t\t\t\tif (!hasStartedSpeaking) {\n\t\t\t\t\t\thasStartedSpeaking = true;\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\n\t\t\t\t\tlastSoundTime = Date.now();\n\t\t\t\t}\n\n\t\t\t\t// Start silence detection only after initial speech/noise has been detected\n\t\t\t\tif (hasStartedSpeaking) {\n\t\t\t\t\tif (Date.now() - lastSoundTime > 2000) {\n\t\t\t\t\t\tconfirmed = true;\n\n\t\t\t\t\t\tif (mediaRecorder) {\n\t\t\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', '🔇 Silence detected');\n\t\t\t\t\t\t\tmediaRecorder.stop();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tlet finishedMessages = {};\n\tlet currentMessageId = null;\n\tlet currentUtterance = null;\n\n\tconst speakSpeechSynthesisHandler = (content) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tlet voices = [];\n\t\t\t\tconst getVoicesLoop = setInterval(async () => {\n\t\t\t\t\tvoices = await speechSynthesis.getVoices();\n\t\t\t\t\tif (voices.length > 0) {\n\t\t\t\t\t\tclearInterval(getVoicesLoop);\n\n\t\t\t\t\t\tconst voice =\n\t\t\t\t\t\t\tvoices\n\t\t\t\t\t\t\t\t?.filter(\n\t\t\t\t\t\t\t\t\t(v) => v.voiceURI === ($settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t?.at(0) ?? undefined;\n\n\t\t\t\t\t\tcurrentUtterance = new SpeechSynthesisUtterance(content);\n\n\t\t\t\t\t\tif (voice) {\n\t\t\t\t\t\t\tcurrentUtterance.voice = voice;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tspeechSynthesis.speak(currentUtterance);\n\t\t\t\t\t\tcurrentUtterance.onend = async (e) => {\n\t\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 200));\n\t\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst playAudio = (audio) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst audioElement = document.getElementById('audioElement');\n\n\t\t\t\tif (audioElement) {\n\t\t\t\t\taudioElement.src = audio.src;\n\t\t\t\t\taudioElement.muted = true;\n\n\t\t\t\t\taudioElement\n\t\t\t\t\t\t.play()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\taudioElement.muted = false;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t});\n\n\t\t\t\t\taudioElement.onended = async (e) => {\n\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\n\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst stopAllAudio = async () => {\n\t\tassistantSpeaking = false;\n\t\tinterrupted = true;\n\n\t\tif (chatStreaming) {\n\t\t\tstopResponse();\n\t\t}\n\n\t\tif (currentUtterance) {\n\t\t\tspeechSynthesis.cancel();\n\t\t\tcurrentUtterance = null;\n\t\t}\n\n\t\tconst audioElement = document.getElementById('audioElement');\n\t\tif (audioElement) {\n\t\t\taudioElement.muted = true;\n\t\t\taudioElement.pause();\n\t\t\taudioElement.currentTime = 0;\n\t\t}\n\t};\n\n\tlet audioAbortController = new AbortController();\n\n\t// Audio cache map where key is the content and value is the Audio object.\n\tconst audioCache = new Map();\n\tconst emojiCache = new Map();\n\n\tconst fetchAudio = async (content) => {\n\t\tif (!audioCache.has(content)) {\n\t\t\ttry {\n\t\t\t\t// Set the emoji for the content if needed\n\t\t\t\tif ($settings?.showEmojiInCall ?? false) {\n\t\t\t\t\tconst emoji = await generateEmoji(localStorage.token, modelId, content, chatId);\n\t\t\t\t\tif (emoji) {\n\t\t\t\t\t\temojiCache.set(content, emoji);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($config.audio.tts.engine !== '') {\n\t\t\t\t\tconst res = await synthesizeOpenAISpeech(\n\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t$settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice,\n\t\t\t\t\t\tcontent\n\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\tconst blob = await res.blob();\n\t\t\t\t\t\tconst blobUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\taudioCache.set(content, new Audio(blobUrl));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\taudioCache.set(content, true);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error synthesizing speech:', error);\n\t\t\t}\n\t\t}\n\n\t\treturn audioCache.get(content);\n\t};\n\n\tlet messages = {};\n\n\tconst monitorAndPlayAudio = async (id, signal) => {\n\t\twhile (!signal.aborted) {\n\t\t\tif (messages[id] && messages[id].length > 0) {\n\t\t\t\t// Retrieve the next content string from the queue\n\t\t\t\tconst content = messages[id].shift(); // Dequeues the content for playing\n\n\t\t\t\tif (audioCache.has(content)) {\n\t\t\t\t\t// If content is available in the cache, play it\n\n\t\t\t\t\t// Set the emoji for the content if available\n\t\t\t\t\tif (($settings?.showEmojiInCall ?? false) && emojiCache.has(content)) {\n\t\t\t\t\t\temoji = emojiCache.get(content);\n\t\t\t\t\t} else {\n\t\t\t\t\t\temoji = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($config.audio.tts.engine !== '') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'%c%s',\n\t\t\t\t\t\t\t\t'color: red; font-size: 20px;',\n\t\t\t\t\t\t\t\t`Playing audio for content: ${content}`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst audio = audioCache.get(content);\n\t\t\t\t\t\t\tawait playAudio(audio); // Here ensure that playAudio is indeed correct method to execute\n\t\t\t\t\t\t\tconsole.log(`Played audio for content: ${content}`);\n\t\t\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Error playing audio:', error);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait speakSpeechSynthesisHandler(content);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If not available in the cache, push it back to the queue and delay\n\t\t\t\t\tmessages[id].unshift(content); // Re-queue the content at the start\n\t\t\t\t\tconsole.log(`Audio for \"${content}\" not yet available in the cache, re-queued...`);\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t}\n\t\t\t} else if (finishedMessages[id] && messages[id] && messages[id].length === 0) {\n\t\t\t\t// If the message is finished and there are no more messages to process, break the loop\n\t\t\t\tassistantSpeaking = false;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\t// No messages to process, sleep for a bit\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200));\n\t\t\t}\n\t\t}\n\t\tconsole.log(`Audio monitoring and playing stopped for message ID ${id}`);\n\t};\n\n\tonMount(async () => {\n\t\tconst setWakeLock = async () => {\n\t\t\ttry {\n\t\t\t\twakeLock = await navigator.wakeLock.request('screen');\n\t\t\t} catch (err) {\n\t\t\t\t// The Wake Lock request has failed - usually system related, such as battery.\n\t\t\t\tconsole.log(err);\n\t\t\t}\n\n\t\t\tif (wakeLock) {\n\t\t\t\t// Add a listener to release the wake lock when the page is unloaded\n\t\t\t\twakeLock.addEventListener('release', () => {\n\t\t\t\t\t// the wake lock has been released\n\t\t\t\t\tconsole.log('Wake Lock released');\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tif ('wakeLock' in navigator) {\n\t\t\tawait setWakeLock();\n\n\t\t\tdocument.addEventListener('visibilitychange', async () => {\n\t\t\t\t// Re-request the wake lock if the document becomes visible\n\t\t\t\tif (wakeLock !== null && document.visibilityState === 'visible') {\n\t\t\t\t\tawait setWakeLock();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tmodel = $models.find((m) => m.id === modelId);\n\n\t\tstartRecording();\n\n\t\tconst chatStartHandler = async (e) => {\n\t\t\tconst { id } = e.detail;\n\n\t\t\tchatStreaming = true;\n\n\t\t\tif (currentMessageId !== id) {\n\t\t\t\tconsole.log(`Received chat start event for message ID ${id}`);\n\n\t\t\t\tcurrentMessageId = id;\n\t\t\t\tif (audioAbortController) {\n\t\t\t\t\taudioAbortController.abort();\n\t\t\t\t}\n\t\t\t\taudioAbortController = new AbortController();\n\n\t\t\t\tassistantSpeaking = true;\n\t\t\t\t// Start monitoring and playing audio for the message ID\n\t\t\t\tmonitorAndPlayAudio(id, audioAbortController.signal);\n\t\t\t}\n\t\t};\n\n\t\tconst chatEventHandler = async (e) => {\n\t\t\tconst { id, content } = e.detail;\n\t\t\t// \"id\" here is message id\n\t\t\t// if \"id\" is not the same as \"currentMessageId\" then do not process\n\t\t\t// \"content\" here is a sentence from the assistant,\n\t\t\t// there will be many sentences for the same \"id\"\n\n\t\t\tif (currentMessageId === id) {\n\t\t\t\tconsole.log(`Received chat event for message ID ${id}: ${content}`);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (messages[id] === undefined) {\n\t\t\t\t\t\tmessages[id] = [content];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmessages[id].push(content);\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(content);\n\n\t\t\t\t\tfetchAudio(content);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Failed to fetch or play audio:', error);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst chatFinishHandler = async (e) => {\n\t\t\tconst { id, content } = e.detail;\n\t\t\t// \"content\" here is the entire message from the assistant\n\t\t\tfinishedMessages[id] = true;\n\n\t\t\tchatStreaming = false;\n\t\t};\n\n\t\teventTarget.addEventListener('chat:start', chatStartHandler);\n\t\teventTarget.addEventListener('chat', chatEventHandler);\n\t\teventTarget.addEventListener('chat:finish', chatFinishHandler);\n\n\t\treturn async () => {\n\t\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\n\t\t\teventTarget.removeEventListener('chat', chatEventHandler);\n\t\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\n\n\t\t\taudioAbortController.abort();\n\t\t\tawait tick();\n\n\t\t\tawait stopAllAudio();\n\n\t\t\tawait stopRecordingCallback(false);\n\t\t\tawait stopCamera();\n\t\t};\n\t});\n\n\tonDestroy(async () => {\n\t\tawait stopAllAudio();\n\t\tawait stopRecordingCallback(false);\n\t\tawait stopCamera();\n\t});\n</script>\n\n{#if $showCallOverlay}\n\t<div class=\"max-w-lg w-full h-full max-h-[100dvh] flex flex-col justify-between p-3 md:p-6\">\n\t\t{#if camera}\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"flex justify-center items-center w-full h-20 min-h-20\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{#if emoji}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t? '4.5'\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t? '4.25'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? '3.75'\n\t\t\t\t\t\t\t\t\t: '3.5'}rem;width: 100%; text-align:center;\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{emoji}\n\t\t\t\t\t</div>\n\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t<svg\n\t\t\t\t\t\tclass=\"size-12 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t>\n\t\t\t\t{:else}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t? ' size-[4.5rem]'\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t? ' size-16'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? 'size-14'\n\t\t\t\t\t\t\t\t\t: 'size-12'}  transition-all rounded-full {(model?.info?.meta\n\t\t\t\t\t\t\t?.profile_image_url ?? '/static/13-Copy.png') !== '/static/13-Copy.png'\n\t\t\t\t\t\t\t? ' bg-cover bg-center bg-no-repeat'\n\t\t\t\t\t\t\t: 'bg-black dark:bg-white'}  bg-black dark:bg-white\"\n\t\t\t\t\t\tstyle={(model?.info?.meta?.profile_image_url ?? '/static/13-Copy.png') !==\n\t\t\t\t\t\t'/static/13-Copy.png'\n\t\t\t\t\t\t\t? `background-image: url('${model?.info?.meta?.profile_image_url}');`\n\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t\t<!-- navbar -->\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<div class=\"flex justify-center items-center flex-1 h-full w-full max-h-full\">\n\t\t\t{#if !camera}\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{#if emoji}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t? '13'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? '12'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? '11.5'\n\t\t\t\t\t\t\t\t\t\t: '11'}rem;width:100%;text-align:center;\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{emoji}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\tclass=\"size-44 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t? ' size-52'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? 'size-48'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? 'size-44'\n\t\t\t\t\t\t\t\t\t\t: 'size-40'}  transition-all rounded-full {(model?.info?.meta\n\t\t\t\t\t\t\t\t?.profile_image_url ?? '/static/13-Copy.png') !== '/static/13-Copy.png'\n\t\t\t\t\t\t\t\t? ' bg-cover bg-center bg-no-repeat'\n\t\t\t\t\t\t\t\t: 'bg-black dark:bg-white'} \"\n\t\t\t\t\t\t\tstyle={(model?.info?.meta?.profile_image_url ?? '/static/13-Copy.png') !==\n\t\t\t\t\t\t\t'/static/13-Copy.png'\n\t\t\t\t\t\t\t\t? `background-image: url('${model?.info?.meta?.profile_image_url}');`\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<div class=\"relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full\">\n\t\t\t\t\t<video\n\t\t\t\t\t\tid=\"camera-feed\"\n\t\t\t\t\t\tautoplay\n\t\t\t\t\t\tclass=\"rounded-2xl h-full min-w-full object-cover object-center\"\n\t\t\t\t\t\tplaysinline\n\t\t\t\t\t/>\n\n\t\t\t\t\t<canvas id=\"camera-canvas\" style=\"display:none;\" />\n\n\t\t\t\t\t<div class=\" absolute top-4 md:top-8 left-4\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclass=\"p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tstopCamera();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"flex justify-between items-center pb-2 w-full\">\n\t\t\t<div>\n\t\t\t\t{#if camera}\n\t\t\t\t\t<VideoInputMenu\n\t\t\t\t\t\tdevices={videoInputDevices}\n\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\tconsole.log(e.detail);\n\t\t\t\t\t\t\tselectedVideoInputDeviceId = e.detail;\n\t\t\t\t\t\t\tawait stopVideoStream();\n\t\t\t\t\t\t\tawait startVideoStream();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button class=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\" type=\"button\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</VideoInputMenu>\n\t\t\t\t{:else}\n\t\t\t\t\t<Tooltip content={$i18n.t('Camera')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\tawait navigator.mediaDevices.getUserMedia({ video: true });\n\t\t\t\t\t\t\t\tstartCamera();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\td=\"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\td=\"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\" line-clamp-1 text-sm font-medium\">\n\t\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t\t{$i18n.t('Thinking...')}\n\t\t\t\t\t\t{:else if assistantSpeaking}\n\t\t\t\t\t\t\t{$i18n.t('Tap to interrupt')}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{$i18n.t('Listening...')}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait stopAudioStream();\n\t\t\t\t\t\tawait stopVideoStream();\n\t\t\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\t\t\tdispatch('close');\n\t\t\t\t\t}}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { onDestroy, onMount, createEventDispatcher } from 'svelte';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { fade, fly, slide } from 'svelte/transition';\n\n\texport let show = false;\n\texport let size = 'md';\n\n\tlet modalElement = null;\n\tlet mounted = false;\n\n\tconst sizeToWidth = (size) => {\n\t\tif (size === 'xs') {\n\t\t\treturn 'w-[16rem]';\n\t\t} else if (size === 'sm') {\n\t\t\treturn 'w-[30rem]';\n\t\t} else if (size === 'md') {\n\t\t\treturn 'w-[48rem]';\n\t\t} else {\n\t\t\treturn 'w-[56rem]';\n\t\t}\n\t};\n\n\tconst handleKeyDown = (event: KeyboardEvent) => {\n\t\tif (event.key === 'Escape' && isTopModal()) {\n\t\t\tconsole.log('Escape');\n\t\t\tshow = false;\n\t\t}\n\t};\n\n\tconst isTopModal = () => {\n\t\tconst modals = document.getElementsByClassName('modal');\n\t\treturn modals.length && modals[modals.length - 1] === modalElement;\n\t};\n\n\tonMount(() => {\n\t\tmounted = true;\n\t});\n\n\t$: if (show && modalElement) {\n\t\tdocument.body.appendChild(modalElement);\n\t\twindow.addEventListener('keydown', handleKeyDown);\n\t\tdocument.body.style.overflow = 'hidden';\n\t} else if (modalElement) {\n\t\twindow.removeEventListener('keydown', handleKeyDown);\n\t\tdocument.body.removeChild(modalElement);\n\t\tdocument.body.style.overflow = 'unset';\n\t}\n\n\tonDestroy(() => {\n\t\tshow = false;\n\t\tif (modalElement) {\n\t\t\tdocument.body.removeChild(modalElement);\n\t\t}\n\t});\n</script>\n\n<!-- svelte-ignore a11y-click-events-have-key-events -->\n<!-- svelte-ignore a11y-no-static-element-interactions -->\n\n<div\n\tbind:this={modalElement}\n\tclass=\"modal fixed right-0 left-0 bottom-0 bg-black/60 w-full h-screen max-h-[100dvh] flex justify-center z-[9999] overflow-hidden overscroll-contain\"\n\tin:fly={{ y: 100, duration: 100 }}\n\ton:mousedown={() => {\n\t\tshow = false;\n\t}}\n>\n\t<div\n\t\tclass=\" mt-auto max-w-full w-full bg-gray-50 dark:bg-gray-900 max-h-[100dvh] overflow-y-auto scrollbar-hidden\"\n\t\ton:mousedown={(e) => {\n\t\t\te.stopPropagation();\n\t\t}}\n\t>\n\t\t<slot />\n\t</div>\n</div>\n\n<style>\n\t.modal-content {\n\t\tanimation: scaleUp 0.1s ease-out forwards;\n\t}\n\n\t@keyframes scaleUp {\n\t\tfrom {\n\t\t\ttransform: scale(0.985);\n\t\t\topacity: 0;\n\t\t}\n\t\tto {\n\t\t\ttransform: scale(1);\n\t\t\topacity: 1;\n\t\t}\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { slide } from 'svelte/transition';\n\timport Modal from '../common/Modal.svelte';\n\timport Controls from './Controls/Controls.svelte';\n\timport { onMount } from 'svelte';\n\timport { mobile, showCallOverlay } from '$lib/stores';\n\timport CallOverlay from './MessageInput/CallOverlay.svelte';\n\timport Drawer from '../common/Drawer.svelte';\n\n\texport let show = false;\n\n\texport let models = [];\n\n\texport let chatId = null;\n\texport let chatFiles = [];\n\texport let params = {};\n\n\texport let eventTarget: EventTarget;\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\texport let files;\n\texport let modelId;\n\n\tlet largeScreen = false;\n\tonMount(() => {\n\t\t// listen to resize 1024px\n\t\tconst mediaQuery = window.matchMedia('(min-width: 1024px)');\n\n\t\tconst handleMediaQuery = (e) => {\n\t\t\tif (e.matches) {\n\t\t\t\tlargeScreen = true;\n\t\t\t} else {\n\t\t\t\tlargeScreen = false;\n\t\t\t}\n\t\t};\n\n\t\tmediaQuery.addEventListener('change', handleMediaQuery);\n\n\t\thandleMediaQuery(mediaQuery);\n\n\t\treturn () => {\n\t\t\tmediaQuery.removeEventListener('change', handleMediaQuery);\n\t\t};\n\t});\n</script>\n\n{#if !largeScreen}\n\t{#if $showCallOverlay}\n\t\t<div class=\" absolute w-full h-screen max-h-[100dvh] flex z-[999] overflow-hidden\">\n\t\t\t<div\n\t\t\t\tclass=\"absolute w-full h-screen max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center\"\n\t\t\t>\n\t\t\t\t<CallOverlay\n\t\t\t\t\tbind:files\n\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t{stopResponse}\n\t\t\t\t\t{modelId}\n\t\t\t\t\t{chatId}\n\t\t\t\t\t{eventTarget}\n\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\tshow = false;\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t{:else if show}\n\t\t<Drawer bind:show>\n\t\t\t<div class=\"  px-6 py-4 h-full\">\n\t\t\t\t<Controls\n\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\tshow = false;\n\t\t\t\t\t}}\n\t\t\t\t\t{models}\n\t\t\t\t\tbind:chatFiles\n\t\t\t\t\tbind:params\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</Drawer>\n\t{/if}\n{:else if show}\n\t<div class=\" absolute bottom-0 right-0 z-20 h-full pointer-events-none\">\n\t\t<div class=\"pr-4 pt-14 pb-8 w-[24rem] h-full\" in:slide={{ duration: 200, axis: 'x' }}>\n\t\t\t<div\n\t\t\t\tclass=\"w-full h-full px-5 py-4 bg-white dark:shadow-lg dark:bg-gray-850 border border-gray-50 dark:border-gray-800 rounded-xl z-50 pointer-events-auto overflow-y-auto scrollbar-hidden\"\n\t\t\t>\n\t\t\t\t{#if $showCallOverlay}\n\t\t\t\t\t<CallOverlay\n\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t{modelId}\n\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t{eventTarget}\n\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\tshow = false;\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t{:else}\n\t\t\t\t\t<Controls\n\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\tshow = false;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\t{models}\n\t\t\t\t\t\tbind:chatFiles\n\t\t\t\t\t\tbind:params\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { v4 as uuidv4 } from 'uuid';\n\timport { toast } from 'svelte-sonner';\n\timport mermaid from 'mermaid';\n\n\timport { getContext, onDestroy, onMount, tick } from 'svelte';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\n\timport type { Unsubscriber, Writable } from 'svelte/store';\n\timport type { i18n as i18nType } from 'i18next';\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\n\timport {\n\t\tchatId,\n\t\tchats,\n\t\tconfig,\n\t\ttype Model,\n\t\tmodels,\n\t\tsettings,\n\t\tshowSidebar,\n\t\tWEBUI_NAME,\n\t\tbanners,\n\t\tuser,\n\t\tsocket,\n\t\tshowCallOverlay,\n\t\tcurrentChatPage,\n\t\ttemporaryChatEnabled\n\t} from '$lib/stores';\n\timport {\n\t\tconvertMessagesToHistory,\n\t\tcopyToClipboard,\n\t\tgetMessageContentParts,\n\t\textractSentencesForAudio,\n\t\tpromptTemplate,\n\t\tsplitStream\n\t} from '$lib/utils';\n\n\timport { generateChatCompletion } from '$lib/apis/ollama';\n\timport {\n\t\tcreateNewChat,\n\t\tgetChatById,\n\t\tgetChatList,\n\t\tgetTagsById,\n\t\tupdateChatById\n\t} from '$lib/apis/chats';\n\timport { generateOpenAIChatCompletion } from '$lib/apis/openai';\n\timport { runWebSearch } from '$lib/apis/rag';\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\n\timport { queryMemory } from '$lib/apis/memories';\n\timport { getAndUpdateUserLocation, getUserSettings } from '$lib/apis/users';\n\timport {\n\t\tchatCompleted,\n\t\tgenerateTitle,\n\t\tgenerateSearchQuery,\n\t\tchatAction,\n\t\tgenerateMoACompletion\n\t} from '$lib/apis';\n\n\timport Banner from '../common/Banner.svelte';\n\timport MessageInput from '$lib/components/chat/MessageInput.svelte';\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Navbar from '$lib/components/layout/Navbar.svelte';\n\timport ChatControls from './ChatControls.svelte';\n\timport EventConfirmDialog from '../common/ConfirmDialog.svelte';\n\n\tconst i18n: Writable<i18nType> = getContext('i18n');\n\n\texport let chatIdProp = '';\n\tlet loaded = false;\n\tconst eventTarget = new EventTarget();\n\n\tlet showControls = false;\n\tlet stopResponseFlag = false;\n\tlet autoScroll = true;\n\tlet processing = '';\n\tlet messagesContainerElement: HTMLDivElement;\n\n\tlet showEventConfirmation = false;\n\tlet eventConfirmationTitle = '';\n\tlet eventConfirmationMessage = '';\n\tlet eventConfirmationInput = false;\n\tlet eventConfirmationInputPlaceholder = '';\n\tlet eventConfirmationInputValue = '';\n\tlet eventCallback = null;\n\n\tlet showModelSelector = true;\n\n\tlet selectedModels = [''];\n\tlet atSelectedModel: Model | undefined;\n\n\tlet selectedModelIds = [];\n\t$: selectedModelIds = atSelectedModel !== undefined ? [atSelectedModel.id] : selectedModels;\n\n\tlet selectedToolIds = [];\n\tlet webSearchEnabled = false;\n\n\tlet chat = null;\n\tlet tags = [];\n\n\tlet title = '';\n\tlet prompt = '';\n\n\tlet chatFiles = [];\n\tlet files = [];\n\tlet messages = [];\n\tlet history = {\n\t\tmessages: {},\n\t\tcurrentId: null\n\t};\n\n\tlet params = {};\n\n\tlet chatIdUnsubscriber: Unsubscriber | undefined;\n\n\t$: if (history.currentId !== null) {\n\t\tlet _messages = [];\n\n\t\tlet currentMessage = history.messages[history.currentId];\n\t\twhile (currentMessage !== null) {\n\t\t\t_messages.unshift({ ...currentMessage });\n\t\t\tcurrentMessage =\n\t\t\t\tcurrentMessage.parentId !== null ? history.messages[currentMessage.parentId] : null;\n\t\t}\n\t\tmessages = _messages;\n\t} else {\n\t\tmessages = [];\n\t}\n\n\t$: if (chatIdProp) {\n\t\t(async () => {\n\t\t\tconsole.log(chatIdProp);\n\t\t\tif (chatIdProp && (await loadChat())) {\n\t\t\t\tawait tick();\n\t\t\t\tloaded = true;\n\n\t\t\t\twindow.setTimeout(() => scrollToBottom(), 0);\n\t\t\t\tconst chatInput = document.getElementById('chat-textarea');\n\t\t\t\tchatInput?.focus();\n\t\t\t} else {\n\t\t\t\tawait goto('/');\n\t\t\t}\n\t\t})();\n\t}\n\n\tconst chatEventHandler = async (event, cb) => {\n\t\tif (event.chat_id === $chatId) {\n\t\t\tawait tick();\n\t\t\tconsole.log(event);\n\t\t\tlet message = history.messages[event.message_id];\n\n\t\t\tconst type = event?.data?.type ?? null;\n\t\t\tconst data = event?.data?.data ?? null;\n\n\t\t\tif (type === 'status') {\n\t\t\t\tif (message?.statusHistory) {\n\t\t\t\t\tmessage.statusHistory.push(data);\n\t\t\t\t} else {\n\t\t\t\t\tmessage.statusHistory = [data];\n\t\t\t\t}\n\t\t\t} else if (type === 'citation') {\n\t\t\t\tif (message?.citations) {\n\t\t\t\t\tmessage.citations.push(data);\n\t\t\t\t} else {\n\t\t\t\t\tmessage.citations = [data];\n\t\t\t\t}\n\t\t\t} else if (type === 'message') {\n\t\t\t\tmessage.content += data.content;\n\t\t\t} else if (type === 'replace') {\n\t\t\t\tmessage.content = data.content;\n\t\t\t} else if (type === 'action') {\n\t\t\t\tif (data.action === 'continue') {\n\t\t\t\t\tconst continueButton = document.getElementById('continue-response-button');\n\n\t\t\t\t\tif (continueButton) {\n\t\t\t\t\t\tcontinueButton.click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (type === 'confirmation') {\n\t\t\t\teventCallback = cb;\n\n\t\t\t\teventConfirmationInput = false;\n\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t} else if (type === 'input') {\n\t\t\t\teventCallback = cb;\n\n\t\t\t\teventConfirmationInput = true;\n\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t\teventConfirmationInputPlaceholder = data.placeholder;\n\t\t\t\teventConfirmationInputValue = data?.value ?? '';\n\t\t\t} else {\n\t\t\t\tconsole.log('Unknown message type', data);\n\t\t\t}\n\n\t\t\tmessages = messages;\n\t\t}\n\t};\n\n\tconst onMessageHandler = async (event: {\n\t\torigin: string;\n\t\tdata: { type: string; text: string };\n\t}) => {\n\t\tif (event.origin !== window.origin) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Replace with your iframe's origin\n\t\tif (event.data.type === 'input:prompt') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tconst inputElement = document.getElementById('chat-textarea');\n\n\t\t\tif (inputElement) {\n\t\t\t\tprompt = event.data.text;\n\t\t\t\tinputElement.focus();\n\t\t\t}\n\t\t}\n\n\t\tif (event.data.type === 'action:submit') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tif (prompt !== '') {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(prompt);\n\t\t\t}\n\t\t}\n\n\t\tif (event.data.type === 'input:prompt:submit') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tif (prompt !== '') {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(event.data.text);\n\t\t\t}\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\twindow.addEventListener('message', onMessageHandler);\n\t\t$socket?.on('chat-events', chatEventHandler);\n\n\t\tif (!$chatId) {\n\t\t\tchatIdUnsubscriber = chatId.subscribe(async (value) => {\n\t\t\t\tif (!value) {\n\t\t\t\t\tawait initNewChat();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tif ($temporaryChatEnabled) {\n\t\t\t\tawait goto('/');\n\t\t\t}\n\t\t}\n\t});\n\n\tonDestroy(() => {\n\t\tchatIdUnsubscriber?.();\n\t\twindow.removeEventListener('message', onMessageHandler);\n\t\t$socket?.off('chat-events');\n\t});\n\n\t//////////////////////////\n\t// Web functions\n\t//////////////////////////\n\n\tconst initNewChat = async () => {\n\t\tif ($page.url.pathname.includes('/c/')) {\n\t\t\twindow.history.replaceState(history.state, '', `/`);\n\t\t}\n\n\t\tawait chatId.set('');\n\t\tautoScroll = true;\n\n\t\ttitle = '';\n\t\tmessages = [];\n\t\thistory = {\n\t\t\tmessages: {},\n\t\t\tcurrentId: null\n\t\t};\n\n\t\tchatFiles = [];\n\t\tparams = {};\n\n\t\tif ($page.url.searchParams.get('models')) {\n\t\t\tselectedModels = $page.url.searchParams.get('models')?.split(',');\n\t\t} else if ($settings?.models) {\n\t\t\tselectedModels = $settings?.models;\n\t\t} else if ($config?.default_models) {\n\t\t\tconsole.log($config?.default_models.split(',') ?? '');\n\t\t\tselectedModels = $config?.default_models.split(',');\n\t\t} else {\n\t\t\tselectedModels = [''];\n\t\t}\n\n\t\tif ($page.url.searchParams.get('web-search') === 'true') {\n\t\t\twebSearchEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('q')) {\n\t\t\tprompt = $page.url.searchParams.get('q') ?? '';\n\t\t\tselectedToolIds = ($page.url.searchParams.get('tool_ids') ?? '')\n\t\t\t\t.split(',')\n\t\t\t\t.map((id) => id.trim())\n\t\t\t\t.filter((id) => id);\n\n\t\t\tif (prompt) {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(prompt);\n\t\t\t}\n\t\t}\n\n\t\tif ($page.url.searchParams.get('call') === 'true') {\n\t\t\tshowCallOverlay.set(true);\n\t\t}\n\n\t\tselectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tconst userSettings = await getUserSettings(localStorage.token);\n\n\t\tif (userSettings) {\n\t\t\tsettings.set(userSettings.ui);\n\t\t} else {\n\t\t\tsettings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\n\t\t}\n\n\t\tconst chatInput = document.getElementById('chat-textarea');\n\t\tsetTimeout(() => chatInput?.focus(), 0);\n\t};\n\n\tconst loadChat = async () => {\n\t\tchatId.set(chatIdProp);\n\t\tchat = await getChatById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\tawait goto('/');\n\t\t\treturn null;\n\t\t});\n\n\t\tif (chat) {\n\t\t\ttags = await getTags();\n\t\t\tconst chatContent = chat.chat;\n\n\t\t\tif (chatContent) {\n\t\t\t\tconsole.log(chatContent);\n\n\t\t\t\tselectedModels =\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.models\n\t\t\t\t\t\t: [chatContent.models ?? ''];\n\t\t\t\thistory =\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.history\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\n\t\t\t\ttitle = chatContent.title;\n\n\t\t\t\tconst userSettings = await getUserSettings(localStorage.token);\n\n\t\t\t\tif (userSettings) {\n\t\t\t\t\tawait settings.set(userSettings.ui);\n\t\t\t\t} else {\n\t\t\t\t\tawait settings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\n\t\t\t\t}\n\n\t\t\t\tparams = chatContent?.params ?? {};\n\t\t\t\tchatFiles = chatContent?.files ?? [];\n\n\t\t\t\tautoScroll = true;\n\t\t\t\tawait tick();\n\n\t\t\t\tif (messages.length > 0) {\n\t\t\t\t\thistory.messages[messages.at(-1).id].done = true;\n\t\t\t\t}\n\t\t\t\tawait tick();\n\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst scrollToBottom = async () => {\n\t\tawait tick();\n\t\tif (messagesContainerElement) {\n\t\t\tmessagesContainerElement.scrollTop = messagesContainerElement.scrollHeight;\n\t\t}\n\t};\n\n\tconst createMessagesList = (responseMessageId) => {\n\t\tconst message = history.messages[responseMessageId];\n\t\tif (message.parentId) {\n\t\t\treturn [...createMessagesList(message.parentId), message];\n\t\t} else {\n\t\t\treturn [message];\n\t\t}\n\t};\n\n\tconst chatCompletedHandler = async (chatId, modelId, responseMessageId, messages) => {\n\t\tawait mermaid.run({\n\t\t\tquerySelector: '.mermaid'\n\t\t});\n\n\t\tconst res = await chatCompleted(localStorage.token, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp\n\t\t\t})),\n\t\t\tchat_id: chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\tmessages.at(-1).error = { content: error };\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t: {}),\n\t\t\t\t\t...message\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif ($chatId == chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst chatActionHandler = async (chatId, actionId, modelId, responseMessageId, event = null) => {\n\t\tconst res = await chatAction(localStorage.token, actionId, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp\n\t\t\t})),\n\t\t\t...(event ? { event: event } : {}),\n\t\t\tchat_id: chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\tmessages.at(-1).error = { content: error };\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t: {}),\n\t\t\t\t\t...message\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif ($chatId == chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst getChatEventEmitter = async (modelId: string, chatId: string = '') => {\n\t\treturn setInterval(() => {\n\t\t\t$socket?.emit('usage', {\n\t\t\t\taction: 'chat',\n\t\t\t\tmodel: modelId,\n\t\t\t\tchat_id: chatId\n\t\t\t});\n\t\t}, 1000);\n\t};\n\n\t//////////////////////////\n\t// Chat functions\n\t//////////////////////////\n\n\tconst submitPrompt = async (userPrompt, { _raw = false } = {}) => {\n\t\tlet _responses = [];\n\t\tconsole.log('submitPrompt', $chatId);\n\n\t\tselectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tif (selectedModels.includes('')) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t} else if (messages.length != 0 && messages.at(-1).done != true) {\n\t\t\t// Response not done\n\t\t\tconsole.log('wait');\n\t\t} else if (messages.length != 0 && messages.at(-1).error) {\n\t\t\t// Error in response\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(\n\t\t\t\t\t`Oops! There was an error in the previous response. Please try again or contact admin.`\n\t\t\t\t)\n\t\t\t);\n\t\t} else if (\n\t\t\tfiles.length > 0 &&\n\t\t\tfiles.filter((file) => file.type !== 'image' && file.status !== 'processed').length > 0\n\t\t) {\n\t\t\t// Upload not done\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(\n\t\t\t\t\t`Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready.`\n\t\t\t\t)\n\t\t\t);\n\t\t} else if (\n\t\t\t($config?.file?.max_count ?? null) !== null &&\n\t\t\tfiles.length + chatFiles.length > $config?.file?.max_count\n\t\t) {\n\t\t\tconsole.log(chatFiles.length, files.length);\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`You can only chat with a maximum of {{maxCount}} file(s) at a time.`, {\n\t\t\t\t\tmaxCount: $config?.file?.max_count\n\t\t\t\t})\n\t\t\t);\n\t\t} else {\n\t\t\t// Reset chat input textarea\n\t\t\tconst chatTextAreaElement = document.getElementById('chat-textarea');\n\n\t\t\tif (chatTextAreaElement) {\n\t\t\t\tchatTextAreaElement.value = '';\n\t\t\t\tchatTextAreaElement.style.height = '';\n\t\t\t}\n\n\t\t\tconst _files = JSON.parse(JSON.stringify(files));\n\t\t\tchatFiles.push(..._files.filter((item) => ['doc', 'file', 'collection'].includes(item.type)));\n\t\t\tchatFiles = chatFiles.filter(\n\t\t\t\t// Remove duplicates\n\t\t\t\t(item, index, array) =>\n\t\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t\t);\n\n\t\t\tfiles = [];\n\n\t\t\tprompt = '';\n\n\t\t\t// Create user message\n\t\t\tlet userMessageId = uuidv4();\n\t\t\tlet userMessage = {\n\t\t\t\tid: userMessageId,\n\t\t\t\tparentId: messages.length !== 0 ? messages.at(-1).id : null,\n\t\t\t\tchildrenIds: [],\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: userPrompt,\n\t\t\t\tfiles: _files.length > 0 ? _files : undefined,\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000), // Unix epoch\n\t\t\t\tmodels: selectedModels\n\t\t\t};\n\n\t\t\t// Add message to history and Set currentId to messageId\n\t\t\thistory.messages[userMessageId] = userMessage;\n\t\t\thistory.currentId = userMessageId;\n\n\t\t\t// Append messageId to childrenIds of parent message\n\t\t\tif (messages.length !== 0) {\n\t\t\t\thistory.messages[messages.at(-1).id].childrenIds.push(userMessageId);\n\t\t\t}\n\n\t\t\t// Wait until history/message have been updated\n\t\t\tawait tick();\n\t\t\t_responses = await sendPrompt(userPrompt, userMessageId, { newChat: true });\n\t\t}\n\n\t\treturn _responses;\n\t};\n\n\tconst sendPrompt = async (\n\t\tprompt: string,\n\t\tparentId: string,\n\t\t{ modelId = null, modelIdx = null, newChat = false } = {}\n\t) => {\n\t\tlet _responses: string[] = [];\n\n\t\t// If modelId is provided, use it, else use selected model\n\t\tlet selectedModelIds = modelId\n\t\t\t? [modelId]\n\t\t\t: atSelectedModel !== undefined\n\t\t\t\t? [atSelectedModel.id]\n\t\t\t\t: selectedModels;\n\n\t\t// Create response messages for each selected model\n\t\tconst responseMessageIds: Record<PropertyKey, string> = {};\n\t\tfor (const [_modelIdx, modelId] of selectedModelIds.entries()) {\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\tif (model) {\n\t\t\t\tlet responseMessageId = uuidv4();\n\t\t\t\tlet responseMessage = {\n\t\t\t\t\tparentId: parentId,\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\trole: 'assistant',\n\t\t\t\t\tcontent: '',\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\t\tmodelIdx: modelIdx ? modelIdx : _modelIdx,\n\t\t\t\t\tuserContext: null,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t\t\t};\n\n\t\t\t\t// Add message to history and Set currentId to messageId\n\t\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\t\thistory.currentId = responseMessageId;\n\n\t\t\t\t// Append messageId to childrenIds of parent message\n\t\t\t\tif (parentId !== null) {\n\t\t\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\t\t\tresponseMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`] = responseMessageId;\n\t\t\t}\n\t\t}\n\t\tawait tick();\n\n\t\t// Create new chat if only one message in messages\n\t\tif (newChat && messages.length == 2) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await createNewChat(localStorage.token, {\n\t\t\t\t\tid: $chatId,\n\t\t\t\t\ttitle: $i18n.t('New Chat'),\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tsystem: $settings.system ?? undefined,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\ttags: [],\n\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\tawait chatId.set(chat.id);\n\t\t\t} else {\n\t\t\t\tawait chatId.set('local');\n\t\t\t}\n\t\t\tawait tick();\n\t\t}\n\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\n\t\tawait Promise.all(\n\t\t\tselectedModelIds.map(async (modelId, _modelIdx) => {\n\t\t\t\tconsole.log('modelId', modelId);\n\t\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\t\tif (model) {\n\t\t\t\t\t// If there are image files, check if model is vision capable\n\t\t\t\t\tconst hasImages = messages.some((message) =>\n\t\t\t\t\t\tmessage.files?.some((file) => file.type === 'image')\n\t\t\t\t\t);\n\n\t\t\t\t\tif (hasImages && !(model.info?.meta?.capabilities?.vision ?? true)) {\n\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t$i18n.t('Model {{modelName}} is not vision capable', {\n\t\t\t\t\t\t\t\tmodelName: model.name ?? model.id\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet responseMessageId =\n\t\t\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`];\n\t\t\t\t\tlet responseMessage = history.messages[responseMessageId];\n\n\t\t\t\t\tlet userContext = null;\n\t\t\t\t\tif ($settings?.memory ?? false) {\n\t\t\t\t\t\tif (userContext === null) {\n\t\t\t\t\t\t\tconst res = await queryMemory(localStorage.token, prompt).catch((error) => {\n\t\t\t\t\t\t\t\ttoast.error(error);\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\tif (res.documents[0].length > 0) {\n\t\t\t\t\t\t\t\t\tuserContext = res.documents[0].reduce((acc, doc, index) => {\n\t\t\t\t\t\t\t\t\t\tconst createdAtTimestamp = res.metadatas[0][index].created_at;\n\t\t\t\t\t\t\t\t\t\tconst createdAtDate = new Date(createdAtTimestamp * 1000)\n\t\t\t\t\t\t\t\t\t\t\t.toISOString()\n\t\t\t\t\t\t\t\t\t\t\t.split('T')[0];\n\t\t\t\t\t\t\t\t\t\treturn `${acc}${index + 1}. [${createdAtDate}]. ${doc}\\n`;\n\t\t\t\t\t\t\t\t\t}, '');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconsole.log(userContext);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresponseMessage.userContext = userContext;\n\n\t\t\t\t\tconst chatEventEmitter = await getChatEventEmitter(model.id, _chatId);\n\n\t\t\t\t\tscrollToBottom();\n\t\t\t\t\tif (webSearchEnabled) {\n\t\t\t\t\t\tawait getWebSearchResults(model.id, parentId, responseMessageId);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet _response = null;\n\t\t\t\t\tif (model?.owned_by === 'openai') {\n\t\t\t\t\t\t_response = await sendPromptOpenAI(model, prompt, responseMessageId, _chatId);\n\t\t\t\t\t} else if (model) {\n\t\t\t\t\t\t_response = await sendPromptOllama(model, prompt, responseMessageId, _chatId);\n\t\t\t\t\t}\n\t\t\t\t\t_responses.push(_response);\n\n\t\t\t\t\tif (chatEventEmitter) clearInterval(chatEventEmitter);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tcurrentChatPage.set(1);\n\t\tchats.set(await getChatList(localStorage.token, $currentChatPage));\n\n\t\treturn _responses;\n\t};\n\n\tconst sendPromptOllama = async (model, userPrompt, responseMessageId, _chatId) => {\n\t\tlet _response: string | null = null;\n\n\t\tconst responseMessage = history.messages[responseMessageId];\n\t\tconst userMessage = history.messages[responseMessage.parentId];\n\n\t\t// Wait until history/message have been updated\n\t\tawait tick();\n\n\t\t// Scroll down\n\t\tscrollToBottom();\n\n\t\tconst messagesBody = [\n\t\t\tparams?.system || $settings.system || (responseMessage?.userContext ?? null)\n\t\t\t\t? {\n\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\tcontent: `${promptTemplate(\n\t\t\t\t\t\t\tparams?.system ?? $settings?.system ?? '',\n\t\t\t\t\t\t\t$user.name,\n\t\t\t\t\t\t\t$settings?.userLocation\n\t\t\t\t\t\t\t\t? await getAndUpdateUserLocation(localStorage.token)\n\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t)}${\n\t\t\t\t\t\t\t(responseMessage?.userContext ?? null)\n\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${responseMessage?.userContext ?? ''}`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t}`\n\t\t\t\t\t}\n\t\t\t\t: undefined,\n\t\t\t...messages\n\t\t]\n\t\t\t.filter((message) => message?.content?.trim())\n\t\t\t.map((message) => {\n\t\t\t\t// Prepare the base message object\n\t\t\t\tconst baseMessage = {\n\t\t\t\t\trole: message.role,\n\t\t\t\t\tcontent: message.content\n\t\t\t\t};\n\n\t\t\t\t// Extract and format image URLs if any exist\n\t\t\t\tconst imageUrls = message.files\n\t\t\t\t\t?.filter((file) => file.type === 'image')\n\t\t\t\t\t.map((file) => file.url.slice(file.url.indexOf(',') + 1));\n\n\t\t\t\t// Add images array only if it contains elements\n\t\t\t\tif (imageUrls && imageUrls.length > 0 && message.role === 'user') {\n\t\t\t\t\tbaseMessage.images = imageUrls;\n\t\t\t\t}\n\t\t\t\treturn baseMessage;\n\t\t\t});\n\n\t\tlet lastImageIndex = -1;\n\n\t\t// Find the index of the last object with images\n\t\tmessagesBody.forEach((item, index) => {\n\t\t\tif (item.images) {\n\t\t\t\tlastImageIndex = index;\n\t\t\t}\n\t\t});\n\n\t\t// Remove images from all but the last one\n\t\tmessagesBody.forEach((item, index) => {\n\t\t\tif (index !== lastImageIndex) {\n\t\t\t\tdelete item.images;\n\t\t\t}\n\t\t});\n\n\t\tlet files = JSON.parse(JSON.stringify(chatFiles));\n\t\tif (model?.info?.meta?.knowledge ?? false) {\n\t\t\t// Only initialize and add status if knowledge exists\n\t\t\tresponseMessage.statusHistory = [\n\t\t\t\t{\n\t\t\t\t\taction: 'knowledge_search',\n\t\t\t\t\tdescription: $i18n.t(`Searching Knowledge for \"{{searchQuery}}\"`, {\n\t\t\t\t\t\tsearchQuery: userMessage.content\n\t\t\t\t\t}),\n\t\t\t\t\tdone: false\n\t\t\t\t}\n\t\t\t];\n\t\t\tfiles.push(...model.info.meta.knowledge);\n\t\t\tmessages = messages; // Trigger Svelte update\n\t\t}\n\t\tfiles.push(\n\t\t\t...(userMessage?.files ?? []).filter((item) =>\n\t\t\t\t['doc', 'file', 'collection'].includes(item.type)\n\t\t\t),\n\t\t\t...(responseMessage?.files ?? []).filter((item) => ['web_search_results'].includes(item.type))\n\t\t);\n\n\t\tscrollToBottom();\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:start', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tawait tick();\n\n\t\tconst [res, controller] = await generateChatCompletion(localStorage.token, {\n\t\t\tstream: true,\n\t\t\tmodel: model.id,\n\t\t\tmessages: messagesBody,\n\t\t\toptions: {\n\t\t\t\t...{ ...($settings?.params ?? {}), ...params },\n\t\t\t\tstop:\n\t\t\t\t\t(params?.stop ?? $settings?.params?.stop ?? undefined)\n\t\t\t\t\t\t? (params?.stop.split(',').map((token) => token.trim()) ?? $settings.params.stop).map(\n\t\t\t\t\t\t\t\t(str) => decodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: undefined,\n\t\t\t\tnum_predict: params?.max_tokens ?? $settings?.params?.max_tokens ?? undefined,\n\t\t\t\trepeat_penalty:\n\t\t\t\t\tparams?.frequency_penalty ?? $settings?.params?.frequency_penalty ?? undefined\n\t\t\t},\n\t\t\tformat: $settings.requestFormat ?? undefined,\n\t\t\tkeep_alive: $settings.keepAlive ?? undefined,\n\t\t\ttool_ids: selectedToolIds.length > 0 ? selectedToolIds : undefined,\n\t\t\tfiles: files.length > 0 ? files : undefined,\n\t\t\tsession_id: $socket?.id,\n\t\t\tchat_id: $chatId,\n\t\t\tid: responseMessageId\n\t\t});\n\n\t\tif (res && res.ok) {\n\t\t\tconsole.log('controller', controller);\n\n\t\t\tconst reader = res.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\n\t\t\t\t\tresponseMessage.done = true;\n\t\t\t\t\tmessages = messages;\n\n\t\t\t\t\tif (stopResponseFlag) {\n\t\t\t\t\t\tcontroller.abort('User: Stop Response');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\n\t\t\t\t\t\tawait chatCompletedHandler(_chatId, model.id, responseMessageId, messages);\n\t\t\t\t\t}\n\n\t\t\t\t\t_response = responseMessage.content;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\tlet data = JSON.parse(line);\n\n\t\t\t\t\t\t\tif ('citations' in data) {\n\t\t\t\t\t\t\t\tresponseMessage.citations = data.citations;\n\t\t\t\t\t\t\t\t// Only remove status if it was initially set\n\t\t\t\t\t\t\t\tif (model?.info?.meta?.knowledge ?? false) {\n\t\t\t\t\t\t\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\n\t\t\t\t\t\t\t\t\t\t(status) => status.action !== 'knowledge_search'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ('detail' in data) {\n\t\t\t\t\t\t\t\tthrow data;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (data.done == false) {\n\t\t\t\t\t\t\t\tif (responseMessage.content == '' && data.message.content == '\\n') {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresponseMessage.content += data.message.content;\n\n\t\t\t\t\t\t\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\n\t\t\t\t\t\t\t\t\t\tnavigator.vibrate(5);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tconst messageContentParts = getMessageContentParts(\n\t\t\t\t\t\t\t\t\t\tresponseMessage.content,\n\t\t\t\t\t\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tmessageContentParts.pop();\n\n\t\t\t\t\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tmessageContentParts.length > 0 &&\n\t\t\t\t\t\t\t\t\t\tmessageContentParts[messageContentParts.length - 1] !==\n\t\t\t\t\t\t\t\t\t\t\tresponseMessage.lastSentence\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tresponseMessage.lastSentence =\n\t\t\t\t\t\t\t\t\t\t\tmessageContentParts[messageContentParts.length - 1];\n\t\t\t\t\t\t\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\t\t\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\t\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresponseMessage.done = true;\n\n\t\t\t\t\t\t\t\tif (responseMessage.content == '') {\n\t\t\t\t\t\t\t\t\tresponseMessage.error = {\n\t\t\t\t\t\t\t\t\t\tcode: 400,\n\t\t\t\t\t\t\t\t\t\tcontent: `Oops! No text generated from Ollama, Please try again.`\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresponseMessage.context = data.context ?? null;\n\t\t\t\t\t\t\t\tresponseMessage.info = {\n\t\t\t\t\t\t\t\t\ttotal_duration: data.total_duration,\n\t\t\t\t\t\t\t\t\tload_duration: data.load_duration,\n\t\t\t\t\t\t\t\t\tsample_count: data.sample_count,\n\t\t\t\t\t\t\t\t\tsample_duration: data.sample_duration,\n\t\t\t\t\t\t\t\t\tprompt_eval_count: data.prompt_eval_count,\n\t\t\t\t\t\t\t\t\tprompt_eval_duration: data.prompt_eval_duration,\n\t\t\t\t\t\t\t\t\teval_count: data.eval_count,\n\t\t\t\t\t\t\t\t\teval_duration: data.eval_duration\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tmessages = messages;\n\n\t\t\t\t\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\n\t\t\t\t\t\t\t\t\tconst notification = new Notification(`${model.id}`, {\n\t\t\t\t\t\t\t\t\t\tbody: responseMessage.content,\n\t\t\t\t\t\t\t\t\t\ticon: `${WEBUI_BASE_URL}/static/13-Copy.png`\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ($settings?.responseAutoCopy ?? false) {\n\t\t\t\t\t\t\t\t\tcopyToClipboard(responseMessage.content);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\n\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tif ('detail' in error) {\n\t\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (autoScroll) {\n\t\t\t\t\tscrollToBottom();\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (res !== null) {\n\t\t\t\tconst error = await res.json();\n\t\t\t\tconsole.log(error);\n\t\t\t\tif ('detail' in error) {\n\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t\tresponseMessage.error = { content: error.detail };\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(error.error);\n\t\t\t\t\tresponseMessage.error = { content: error.error };\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, { provider: 'Ollama' })\n\t\t\t\t);\n\t\t\t\tresponseMessage.error = {\n\t\t\t\t\tcontent: $i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\n\t\t\t\t\t\tprovider: 'Ollama'\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t\tresponseMessage.done = true;\n\n\t\t\tif (responseMessage.statusHistory) {\n\t\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\n\t\t\t\t\t(status) => status.action !== 'knowledge_search'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tmessages = messages;\n\t\t}\n\t\tawait saveChatHandler(_chatId);\n\n\t\tstopResponseFlag = false;\n\t\tawait tick();\n\n\t\tlet lastMessageContentPart =\n\t\t\tgetMessageContentParts(\n\t\t\t\tresponseMessage.content,\n\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t)?.at(-1) ?? '';\n\t\tif (lastMessageContentPart) {\n\t\t\teventTarget.dispatchEvent(\n\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\tdetail: { id: responseMessageId, content: lastMessageContentPart }\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:finish', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tcontent: responseMessage.content\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tif (messages.length == 2 && messages.at(1).content !== '' && selectedModels[0] === model.id) {\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\n\t\t\tconst _title = await generateChatTitle(userPrompt);\n\t\t\tawait setChatTitle(_chatId, _title);\n\t\t}\n\n\t\treturn _response;\n\t};\n\n\tconst sendPromptOpenAI = async (model, userPrompt, responseMessageId, _chatId) => {\n\t\tlet _response = null;\n\n\t\tconst responseMessage = history.messages[responseMessageId];\n\t\tconst userMessage = history.messages[responseMessage.parentId];\n\n\t\tlet files = JSON.parse(JSON.stringify(chatFiles));\n\t\tif (model?.info?.meta?.knowledge ?? false) {\n\t\t\t// Only initialize and add status if knowledge exists\n\t\t\tresponseMessage.statusHistory = [\n\t\t\t\t{\n\t\t\t\t\taction: 'knowledge_search',\n\t\t\t\t\tdescription: $i18n.t(`Searching Knowledge for \"{{searchQuery}}\"`, {\n\t\t\t\t\t\tsearchQuery: userMessage.content\n\t\t\t\t\t}),\n\t\t\t\t\tdone: false\n\t\t\t\t}\n\t\t\t];\n\t\t\tfiles.push(...model.info.meta.knowledge);\n\t\t\tmessages = messages; // Trigger Svelte update\n\t\t}\n\t\tfiles.push(\n\t\t\t...(userMessage?.files ?? []).filter((item) =>\n\t\t\t\t['doc', 'file', 'collection'].includes(item.type)\n\t\t\t),\n\t\t\t...(responseMessage?.files ?? []).filter((item) => ['web_search_results'].includes(item.type))\n\t\t);\n\n\t\tscrollToBottom();\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:start', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tawait tick();\n\n\t\ttry {\n\t\t\tconst [res, controller] = await generateOpenAIChatCompletion(\n\t\t\t\tlocalStorage.token,\n\t\t\t\t{\n\t\t\t\t\tstream: true,\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tstream_options:\n\t\t\t\t\t\t(model.info?.meta?.capabilities?.usage ?? false)\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tinclude_usage: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\tmessages: [\n\t\t\t\t\t\tparams?.system || $settings.system || (responseMessage?.userContext ?? null)\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\t\t\t\tcontent: `${promptTemplate(\n\t\t\t\t\t\t\t\t\t\tparams?.system ?? $settings?.system ?? '',\n\t\t\t\t\t\t\t\t\t\t$user.name,\n\t\t\t\t\t\t\t\t\t\t$settings?.userLocation\n\t\t\t\t\t\t\t\t\t\t\t? await getAndUpdateUserLocation(localStorage.token)\n\t\t\t\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t\t\t\t)}${\n\t\t\t\t\t\t\t\t\t\t(responseMessage?.userContext ?? null)\n\t\t\t\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${responseMessage?.userContext ?? ''}`\n\t\t\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t...messages\n\t\t\t\t\t]\n\t\t\t\t\t\t.filter((message) => message?.content?.trim())\n\t\t\t\t\t\t.map((message, idx, arr) => ({\n\t\t\t\t\t\t\trole: message.role,\n\t\t\t\t\t\t\t...((message.files?.filter((file) => file.type === 'image').length > 0 ?? false) &&\n\t\t\t\t\t\t\tmessage.role === 'user'\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\t\t\t\ttext:\n\t\t\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? message.content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: (message?.raContent ?? message.content)\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t...message.files\n\t\t\t\t\t\t\t\t\t\t\t\t.filter((file) => file.type === 'image')\n\t\t\t\t\t\t\t\t\t\t\t\t.map((file) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image_url',\n\t\t\t\t\t\t\t\t\t\t\t\t\timage_url: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: file.url\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\t\t\tcontent:\n\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\n\t\t\t\t\t\t\t\t\t\t\t\t? message.content\n\t\t\t\t\t\t\t\t\t\t\t\t: (message?.raContent ?? message.content)\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t})),\n\t\t\t\t\tseed: params?.seed ?? $settings?.params?.seed ?? undefined,\n\t\t\t\t\tstop:\n\t\t\t\t\t\t(params?.stop ?? $settings?.params?.stop ?? undefined)\n\t\t\t\t\t\t\t? (params?.stop.split(',').map((token) => token.trim()) ?? $settings.params.stop).map(\n\t\t\t\t\t\t\t\t\t(str) => decodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\ttemperature: params?.temperature ?? $settings?.params?.temperature ?? undefined,\n\t\t\t\t\ttop_p: params?.top_p ?? $settings?.params?.top_p ?? undefined,\n\t\t\t\t\tfrequency_penalty:\n\t\t\t\t\t\tparams?.frequency_penalty ?? $settings?.params?.frequency_penalty ?? undefined,\n\t\t\t\t\tmax_tokens: params?.max_tokens ?? $settings?.params?.max_tokens ?? undefined,\n\t\t\t\t\ttool_ids: selectedToolIds.length > 0 ? selectedToolIds : undefined,\n\t\t\t\t\tfiles: files.length > 0 ? files : undefined,\n\t\t\t\t\tsession_id: $socket?.id,\n\t\t\t\t\tchat_id: $chatId,\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t},\n\t\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t\t);\n\n\t\t\t// Wait until history/message have been updated\n\t\t\tawait tick();\n\n\t\t\tscrollToBottom();\n\n\t\t\tif (res && res.ok && res.body) {\n\t\t\t\tconst textStream = await createOpenAITextStream(res.body, $settings.splitLargeChunks);\n\n\t\t\t\tfor await (const update of textStream) {\n\t\t\t\t\tconst { value, done, citations, error, usage } = update;\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\n\t\t\t\t\t\tresponseMessage.done = true;\n\t\t\t\t\t\tmessages = messages;\n\n\t\t\t\t\t\tif (stopResponseFlag) {\n\t\t\t\t\t\t\tcontroller.abort('User: Stop Response');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\n\n\t\t\t\t\t\t\tawait chatCompletedHandler(_chatId, model.id, responseMessageId, messages);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_response = responseMessage.content;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (usage) {\n\t\t\t\t\t\tresponseMessage.info = { ...usage, openai: true };\n\t\t\t\t\t}\n\n\t\t\t\t\tif (citations) {\n\t\t\t\t\t\tresponseMessage.citations = citations;\n\t\t\t\t\t\t// Only remove status if it was initially set\n\t\t\t\t\t\tif (model?.info?.meta?.knowledge ?? false) {\n\t\t\t\t\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\n\t\t\t\t\t\t\t\t(status) => status.action !== 'knowledge_search'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (responseMessage.content == '' && value == '\\n') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresponseMessage.content += value;\n\n\t\t\t\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\n\t\t\t\t\t\t\tnavigator.vibrate(5);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst messageContentParts = getMessageContentParts(\n\t\t\t\t\t\t\tresponseMessage.content,\n\t\t\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t\t\t\t);\n\t\t\t\t\t\tmessageContentParts.pop();\n\n\t\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmessageContentParts.length > 0 &&\n\t\t\t\t\t\t\tmessageContentParts[messageContentParts.length - 1] !== responseMessage.lastSentence\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresponseMessage.lastSentence = messageContentParts[messageContentParts.length - 1];\n\t\t\t\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\n\t\t\t\t\tconst notification = new Notification(`${model.id}`, {\n\t\t\t\t\t\tbody: responseMessage.content,\n\t\t\t\t\t\ticon: `${WEBUI_BASE_URL}/static/13-Copy.png`\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif ($settings.responseAutoCopy) {\n\t\t\t\t\tcopyToClipboard(responseMessage.content);\n\t\t\t\t}\n\n\t\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\n\t\t\t\t\tawait tick();\n\n\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tawait handleOpenAIError(null, res, model, responseMessage);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\n\t\t}\n\n\t\tawait saveChatHandler(_chatId);\n\n\t\tmessages = messages;\n\n\t\tstopResponseFlag = false;\n\t\tawait tick();\n\n\t\tlet lastMessageContentPart =\n\t\t\tgetMessageContentParts(\n\t\t\t\tresponseMessage.content,\n\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t)?.at(-1) ?? '';\n\t\tif (lastMessageContentPart) {\n\t\t\teventTarget.dispatchEvent(\n\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\tdetail: { id: responseMessageId, content: lastMessageContentPart }\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:finish', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tcontent: responseMessage.content\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tif (messages.length == 2 && selectedModels[0] === model.id) {\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\n\n\t\t\tconst _title = await generateChatTitle(userPrompt);\n\t\t\tawait setChatTitle(_chatId, _title);\n\t\t}\n\n\t\treturn _response;\n\t};\n\n\tconst handleOpenAIError = async (error, res: Response | null, model, responseMessage) => {\n\t\tlet errorMessage = '';\n\t\tlet innerError;\n\n\t\tif (error) {\n\t\t\tinnerError = error;\n\t\t} else if (res !== null) {\n\t\t\tinnerError = await res.json();\n\t\t}\n\t\tconsole.error(innerError);\n\t\tif ('detail' in innerError) {\n\t\t\ttoast.error(innerError.detail);\n\t\t\terrorMessage = innerError.detail;\n\t\t} else if ('error' in innerError) {\n\t\t\tif ('message' in innerError.error) {\n\t\t\t\ttoast.error(innerError.error.message);\n\t\t\t\terrorMessage = innerError.error.message;\n\t\t\t} else {\n\t\t\t\ttoast.error(innerError.error);\n\t\t\t\terrorMessage = innerError.error;\n\t\t\t}\n\t\t} else if ('message' in innerError) {\n\t\t\ttoast.error(innerError.message);\n\t\t\terrorMessage = innerError.message;\n\t\t}\n\n\t\tresponseMessage.error = {\n\t\t\tcontent:\n\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\n\t\t\t\t\tprovider: model.name ?? model.id\n\t\t\t\t}) +\n\t\t\t\t'\\n' +\n\t\t\t\terrorMessage\n\t\t};\n\t\tresponseMessage.done = true;\n\n\t\tif (responseMessage.statusHistory) {\n\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\n\t\t\t\t(status) => status.action !== 'knowledge_search'\n\t\t\t);\n\t\t}\n\n\t\tmessages = messages;\n\t};\n\n\tconst stopResponse = () => {\n\t\tstopResponseFlag = true;\n\t\tconsole.log('stopResponse');\n\t};\n\n\tconst regenerateResponse = async (message) => {\n\t\tconsole.log('regenerateResponse');\n\n\t\tif (messages.length != 0) {\n\t\t\tlet userMessage = history.messages[message.parentId];\n\t\t\tlet userPrompt = userMessage.content;\n\n\t\t\tif ((userMessage?.models ?? [...selectedModels]).length == 1) {\n\t\t\t\t// If user message has only one model selected, sendPrompt automatically selects it for regeneration\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id);\n\t\t\t} else {\n\t\t\t\t// If there are multiple models selected, use the model of the response message for regeneration\n\t\t\t\t// e.g. many model chat\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id, {\n\t\t\t\t\tmodelId: message.model,\n\t\t\t\t\tmodelIdx: message.modelIdx\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\tconst continueGeneration = async () => {\n\t\tconsole.log('continueGeneration');\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\n\t\tif (messages.length != 0 && messages.at(-1).done == true) {\n\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\tresponseMessage.done = false;\n\t\t\tawait tick();\n\n\t\t\tconst model = $models.filter((m) => m.id === responseMessage.model).at(0);\n\n\t\t\tif (model) {\n\t\t\t\tif (model?.owned_by === 'openai') {\n\t\t\t\t\tawait sendPromptOpenAI(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\n\t\t\t\t\t\tresponseMessage.id,\n\t\t\t\t\t\t_chatId\n\t\t\t\t\t);\n\t\t\t\t} else\n\t\t\t\t\tawait sendPromptOllama(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\n\t\t\t\t\t\tresponseMessage.id,\n\t\t\t\t\t\t_chatId\n\t\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\n\t\t}\n\t};\n\n\tconst generateChatTitle = async (userPrompt) => {\n\t\tif ($settings?.title?.auto ?? true) {\n\t\t\tconst title = await generateTitle(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tselectedModels[0],\n\t\t\t\tuserPrompt,\n\t\t\t\t$chatId\n\t\t\t).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t\treturn 'New Chat';\n\t\t\t});\n\n\t\t\treturn title;\n\t\t} else {\n\t\t\treturn `${userPrompt}`;\n\t\t}\n\t};\n\n\tconst setChatTitle = async (_chatId, _title) => {\n\t\tif (_chatId === $chatId) {\n\t\t\ttitle = _title;\n\t\t}\n\n\t\tif (!$temporaryChatEnabled) {\n\t\t\tchat = await updateChatById(localStorage.token, _chatId, { title: _title });\n\n\t\t\tcurrentChatPage.set(1);\n\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t}\n\t};\n\n\tconst getWebSearchResults = async (model: string, parentId: string, responseId: string) => {\n\t\tconst responseMessage = history.messages[responseId];\n\t\tconst userMessage = history.messages[parentId];\n\n\t\tresponseMessage.statusHistory = [\n\t\t\t{\n\t\t\t\tdone: false,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: $i18n.t('Generating search query')\n\t\t\t}\n\t\t];\n\t\tmessages = messages;\n\n\t\tconst prompt = userMessage.content;\n\t\tlet searchQuery = await generateSearchQuery(\n\t\t\tlocalStorage.token,\n\t\t\tmodel,\n\t\t\tmessages.filter((message) => message?.content?.trim()),\n\t\t\tprompt\n\t\t).catch((error) => {\n\t\t\tconsole.log(error);\n\t\t\treturn prompt;\n\t\t});\n\n\t\tif (!searchQuery || searchQuery == '') {\n\t\t\tresponseMessage.statusHistory.push({\n\t\t\t\tdone: true,\n\t\t\t\terror: true,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: $i18n.t('No search query generated')\n\t\t\t});\n\t\t\tmessages = messages;\n\t\t\treturn;\n\t\t}\n\n\t\tresponseMessage.statusHistory.push({\n\t\t\tdone: false,\n\t\t\taction: 'web_search',\n\t\t\tdescription: $i18n.t(`Searching \"{{searchQuery}}\"`, { searchQuery })\n\t\t});\n\t\tmessages = messages;\n\n\t\tconst results = await runWebSearch(localStorage.token, searchQuery).catch((error) => {\n\t\t\tconsole.log(error);\n\t\t\ttoast.error(error);\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (results) {\n\t\t\tresponseMessage.statusHistory.push({\n\t\t\t\tdone: true,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: $i18n.t('Searched {{count}} sites', { count: results.filenames.length }),\n\t\t\t\tquery: searchQuery,\n\t\t\t\turls: results.filenames\n\t\t\t});\n\n\t\t\tif (responseMessage?.files ?? undefined === undefined) {\n\t\t\t\tresponseMessage.files = [];\n\t\t\t}\n\n\t\t\tresponseMessage.files.push({\n\t\t\t\tcollection_name: results.collection_name,\n\t\t\t\tname: searchQuery,\n\t\t\t\ttype: 'web_search_results',\n\t\t\t\turls: results.filenames\n\t\t\t});\n\n\t\t\tmessages = messages;\n\t\t} else {\n\t\t\tresponseMessage.statusHistory.push({\n\t\t\t\tdone: true,\n\t\t\t\terror: true,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: 'No search results found'\n\t\t\t});\n\t\t\tmessages = messages;\n\t\t}\n\t};\n\n\tconst getTags = async () => {\n\t\treturn await getTagsById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\treturn [];\n\t\t});\n\t};\n\n\tconst saveChatHandler = async (_chatId) => {\n\t\tif ($chatId == _chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\t};\n\tconst mergeResponses = async (messageId, responses, _chatId) => {\n\t\tconsole.log('mergeResponses', messageId, responses);\n\t\tconst message = history.messages[messageId];\n\t\tconst mergedResponse = {\n\t\t\tstatus: true,\n\t\t\tcontent: ''\n\t\t};\n\t\tmessage.merged = mergedResponse;\n\t\tmessages = messages;\n\n\t\ttry {\n\t\t\tconst [res, controller] = await generateMoACompletion(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tmessage.model,\n\t\t\t\thistory.messages[message.parentId].content,\n\t\t\t\tresponses\n\t\t\t);\n\n\t\t\tif (res && res.ok && res.body) {\n\t\t\t\tconst textStream = await createOpenAITextStream(res.body, $settings.splitLargeChunks);\n\t\t\t\tfor await (const update of textStream) {\n\t\t\t\t\tconst { value, done, citations, error, usage } = update;\n\t\t\t\t\tif (error || done) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mergedResponse.content == '' && value == '\\n') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmergedResponse.content += value;\n\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tawait saveChatHandler(_chatId);\n\t\t\t} else {\n\t\t\t\tconsole.error(res);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t};\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{title\n\t\t\t? `${title.length > 30 ? `${title.slice(0, 30)}...` : title} | ${$WEBUI_NAME}`\n\t\t\t: `${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n<audio id=\"audioElement\" src=\"\" style=\"display: none;\" />\n\n<EventConfirmDialog\n\tbind:show={showEventConfirmation}\n\ttitle={eventConfirmationTitle}\n\tmessage={eventConfirmationMessage}\n\tinput={eventConfirmationInput}\n\tinputPlaceholder={eventConfirmationInputPlaceholder}\n\tinputValue={eventConfirmationInputValue}\n\ton:confirm={(e) => {\n\t\tif (e.detail) {\n\t\t\teventCallback(e.detail);\n\t\t} else {\n\t\t\teventCallback(true);\n\t\t}\n\t}}\n\ton:cancel={() => {\n\t\teventCallback(false);\n\t}}\n/>\n\n{#if !chatIdProp || (loaded && chatIdProp)}\n\t<div\n\t\tclass=\"h-screen max-h-[100dvh] {$showSidebar\n\t\t\t? 'md:max-w-[calc(100%-260px)]'\n\t\t\t: ''} w-full max-w-full flex flex-col\"\n\t>\n\t\t{#if $settings?.backgroundImageUrl ?? null}\n\t\t\t<div\n\t\t\t\tclass=\"absolute {$showSidebar\n\t\t\t\t\t? 'md:max-w-[calc(100%-260px)] md:translate-x-[260px]'\n\t\t\t\t\t: ''} top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\tstyle=\"background-image: url({$settings.backgroundImageUrl})  \"\n\t\t\t/>\n\n\t\t\t<div\n\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-gradient-to-t from-white to-white/85 dark:from-gray-900 dark:to-[#171717]/90 z-0\"\n\t\t\t/>\n\t\t{/if}\n\n\t\t<Navbar\n\t\t\t{title}\n\t\t\tbind:selectedModels\n\t\t\tbind:showModelSelector\n\t\t\tbind:showControls\n\t\t\tshareEnabled={messages.length > 0}\n\t\t\t{chat}\n\t\t\t{initNewChat}\n\t\t/>\n\n\t\t{#if $banners.length > 0 && messages.length === 0 && !$chatId && selectedModels.length <= 1}\n\t\t\t<div\n\t\t\t\tclass=\"absolute top-[4.25rem] w-full {$showSidebar\n\t\t\t\t\t? 'md:max-w-[calc(100%-260px)]'\n\t\t\t\t\t: ''} {showControls ? 'lg:pr-[24rem]' : ''} z-20\"\n\t\t\t>\n\t\t\t\t<div class=\" flex flex-col gap-1 w-full\">\n\t\t\t\t\t{#each $banners.filter( (b) => (b.dismissible ? !JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]').includes(b.id) : true) ) as banner}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\t{banner}\n\t\t\t\t\t\t\ton:dismiss={(e) => {\n\t\t\t\t\t\t\t\tconst bannerId = e.detail;\n\n\t\t\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\t\t'dismissedBannerIds',\n\t\t\t\t\t\t\t\t\tJSON.stringify(\n\t\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t\tbannerId,\n\t\t\t\t\t\t\t\t\t\t\t...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]')\n\t\t\t\t\t\t\t\t\t\t].filter((id) => $banners.find((b) => b.id === id))\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"flex flex-col flex-auto z-10\">\n\t\t\t<div\n\t\t\t\tclass=\" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden {showControls\n\t\t\t\t\t? 'lg:pr-[24rem]'\n\t\t\t\t\t: ''}\"\n\t\t\t\tid=\"messages-container\"\n\t\t\t\tbind:this={messagesContainerElement}\n\t\t\t\ton:scroll={(e) => {\n\t\t\t\t\tautoScroll =\n\t\t\t\t\t\tmessagesContainerElement.scrollHeight - messagesContainerElement.scrollTop <=\n\t\t\t\t\t\tmessagesContainerElement.clientHeight + 5;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" h-full w-full flex flex-col {chatIdProp ? 'py-4' : 'pt-2 pb-4'}\">\n\t\t\t\t\t<Messages\n\t\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t{processing}\n\t\t\t\t\t\tbind:history\n\t\t\t\t\t\tbind:messages\n\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\tbottomPadding={files.length > 0}\n\t\t\t\t\t\t{sendPrompt}\n\t\t\t\t\t\t{continueGeneration}\n\t\t\t\t\t\t{regenerateResponse}\n\t\t\t\t\t\t{mergeResponses}\n\t\t\t\t\t\t{chatActionHandler}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class={showControls ? 'lg:pr-[24rem]' : ''}>\n\t\t\t\t<MessageInput\n\t\t\t\t\tbind:files\n\t\t\t\t\tbind:prompt\n\t\t\t\t\tbind:autoScroll\n\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\tavailableToolIds={selectedModelIds.reduce((a, e, i, arr) => {\n\t\t\t\t\t\tconst model = $models.find((m) => m.id === e);\n\t\t\t\t\t\tif (model?.info?.meta?.toolIds ?? false) {\n\t\t\t\t\t\t\treturn [...new Set([...a, ...model.info.meta.toolIds])];\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn a;\n\t\t\t\t\t}, [])}\n\t\t\t\t\ttransparentBackground={$settings?.backgroundImageUrl ?? false}\n\t\t\t\t\t{selectedModels}\n\t\t\t\t\t{messages}\n\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t{stopResponse}\n\t\t\t\t\ton:call={() => {\n\t\t\t\t\t\tshowControls = true;\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n<ChatControls\n\tmodels={selectedModelIds.reduce((a, e, i, arr) => {\n\t\tconst model = $models.find((m) => m.id === e);\n\t\tif (model) {\n\t\t\treturn [...a, model];\n\t\t}\n\t\treturn a;\n\t}, [])}\n\tbind:show={showControls}\n\tbind:chatFiles\n\tbind:params\n\tbind:files\n\t{submitPrompt}\n\t{stopResponse}\n\tmodelId={selectedModelIds?.at(0) ?? null}\n\tchatId={$chatId}\n\t{eventTarget}\n/>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport Modal from '../common/Modal.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n</script>\n\n<Modal bind:show>\n\t<div class=\"text-gray-700 dark:text-gray-100\">\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pt-4\">\n\t\t\t<div class=\" text-lg font-medium self-center\">{$i18n.t('Keyboard shortcuts')}</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200\">\n\t\t\t<div class=\" flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6\">\n\t\t\t\t<div class=\"flex flex-col space-y-3 w-full self-start\">\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Open new chat')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/⌘\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tO\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Focus chat input')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tEsc\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Copy last code block')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/⌘\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Copy last response')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/⌘\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tC\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex flex-col space-y-3 w-full self-start\">\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Toggle settings')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/⌘\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t.\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Toggle sidebar')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/⌘\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tS\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Delete chat')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/⌘\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t⌫\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Show shortcuts')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/⌘\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t/\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5\">\n\t\t\t<div class=\" text-lg font-medium self-center\">{$i18n.t('Input commands')}</div>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200\">\n\t\t\t<div class=\" flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6\">\n\t\t\t\t<div class=\"flex flex-col space-y-3 w-full self-start\">\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">\n\t\t\t\t\t\t\t{$i18n.t('Attach file')}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t#\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">\n\t\t\t\t\t\t\t{$i18n.t('Add custom prompt')}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t/\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">\n\t\t\t\t\t\t\t{$i18n.t('Select model')}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t@\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</Modal>\n\n<style>\n\tinput::-webkit-outer-spin-button,\n\tinput::-webkit-inner-spin-button {\n\t\t/* display: none; <- Crashes Chrome on hover */\n\t\t-webkit-appearance: none;\n\t\tmargin: 0; /* <-- Apparently some margin are still there even though it's hidden */\n\t}\n\n\t.tabs::-webkit-scrollbar {\n\t\tdisplay: none; /* for Chrome, Safari and Opera */\n\t}\n\n\t.tabs {\n\t\t-ms-overflow-style: none; /* IE and Edge */\n\t\tscrollbar-width: none; /* Firefox */\n\t}\n\n\tinput[type='number'] {\n\t\t-moz-appearance: textfield; /* Firefox */\n\t}\n</style>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tclass={className}\n>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7Zm5.01 1H5v2.01h2.01V8Zm3 0H8v2.01h2.01V8Zm3 0H11v2.01h2.01V8Zm3 0H14v2.01h2.01V8Zm3 0H17v2.01h2.01V8Zm-12 3H5v2.01h2.01V11Zm3 0H8v2.01h2.01V11Zm3 0H11v2.01h2.01V11Zm3 0H14v2.01h2.01V11Zm3 0H17v2.01h2.01V11Zm-12 3H5v2.01h2.01V14ZM8 14l-.001 2 8.011.01V14H8Zm11.01 0H17v2.01h2.01V14Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext } from 'svelte';\n\n\timport { showSettings } from '$lib/stores';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport QuestionMarkCircle from '$lib/components/icons/QuestionMarkCircle.svelte';\n\timport Lifebuoy from '$lib/components/icons/Lifebuoy.svelte';\n\timport Keyboard from '$lib/components/icons/Keyboard.svelte';\n\tconst i18n = getContext('i18n');\n\n\texport let showDocsHandler: Function;\n\texport let showShortcutsHandler: Function;\n\n\texport let onClose: Function = () => {};\n</script>\n\n<Dropdown\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\tsideOffset={4}\n\t\t\tside=\"top\"\n\t\t\talign=\"end\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\tid=\"chat-share-button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\twindow.open('https://docs.openwebui.com', '_blank');\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<QuestionMarkCircle className=\"size-5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Documentation')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\tid=\"chat-share-button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshowShortcutsHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Keyboard className=\"size-5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Keyboard shortcuts')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { onMount, tick, getContext } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\n\timport ShortcutsModal from '../chat/ShortcutsModal.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport HelpMenu from './Help/HelpMenu.svelte';\n\n\tlet showShortcuts = false;\n</script>\n\n<div class=\" hidden lg:flex fixed bottom-0 right-0 px-2 py-2 z-20\">\n\t<button\n\t\tid=\"show-shortcuts-button\"\n\t\tclass=\"hidden\"\n\t\ton:click={() => {\n\t\t\tshowShortcuts = !showShortcuts;\n\t\t}}\n\t/>\n\n\t<HelpMenu\n\t\tshowDocsHandler={() => {\n\t\t\tshowShortcuts = !showShortcuts;\n\t\t}}\n\t\tshowShortcutsHandler={() => {\n\t\t\tshowShortcuts = !showShortcuts;\n\t\t}}\n\t>\n\t\t<Tooltip content={$i18n.t('Help')} placement=\"left\">\n\t\t\t<button\n\t\t\t\tclass=\"text-gray-600 dark:text-gray-300 bg-gray-300/20 size-5 flex items-center justify-center text-[0.7rem] rounded-full\"\n\t\t\t>\n\t\t\t\t?\n\t\t\t</button>\n\t\t</Tooltip>\n\t</HelpMenu>\n</div>\n\n<ShortcutsModal bind:show={showShortcuts} />\n"],"names":["ctx","disabled","$$props","open","onOpenChange","updateOption","ids","subOpen","setSubMenuCtx","next","$$invalidate","idValues","derived","$menuId","$triggerId","div_levels","insert_hydration","target","div","anchor","transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el","subMenu","getAttrs","getSubmenuCtx","dispatch","createDispatcher","attrs","$$value","builder","$subMenu","updateSubPositioning","subTrigger","options","getSubTrigger","disabledStore","$subTrigger","disabledAttrs","$disabledStore","createParser","onParse","isFirstChunk","buffer","startingPosition","startingFieldLength","eventId","eventName","data","reset","feed","chunk","hasBom","BOM","length","position","discardTrailingNewline","lineLength","fieldLength","character","index","parseEventStreamLine","lineBuffer","noValue","field","step","valueLength","value","retry","charCode","EventSourceParserStream","parser","controller","event","createOpenAITextStream","responseBody","splitLargeDeltas","eventStream","iterator","openAIStreamToIterator","streamLargeDeltasAsRandomChunks","reader","done","parsedData","_c","_b","_a","e","textStreamUpdate","content","chunkSize","sleep","ms","resolve","create_if_block_1","t0_value","t3_value","if_block0","create_if_block_4","if_block1","create_if_block_3","if_block2","create_if_block_2","attr","div0","div0_class_value","div5","append_hydration","div3","div1","div2","div4","current","dirty","set_data","t0","t3","div5_transition","create_bidirectional_transition","fade","button","create_if_block","createEventDispatcher","banner","dismissed","mounted","classNames","dismiss","onMount","svg","path0","path1","className","path","i","hr","each_blocks","t","t_value","tooltip_changes","t1","t1_value","show_if","flyAndScale","i18n","getContext","uploadFilesHandler","selectedToolIds","webSearchEnabled","tools","onClose","show","toolId","strokeWidth","div_class_value","set_style","t2_value","button_class_value","div6","div6_class_value","t2","VISUALIZER_BUFFER_LENGTH","recording","loading","confirmed","durationSeconds","durationCounter","transcription","startDurationCounter","stopDurationCounter","formatSeconds","seconds","minutes","remainingSeconds","formattedSeconds","speechRecognition","mediaRecorder","audioChunks","MIN_DECIBELS","visualizerData","calculateRMS","sumSquares","normalizedValue","normalizeRMS","rms","scaledRMS","analyseAudio","stream","audioContext","audioStreamSource","analyser","bufferLength","domainData","timeDomainData","processFrame","rmsLevel","transcribeHandler","audioBlob","tick","file","blobToFile","res","transcribeAudio","error","toast","startRecording","$settings","$config","inactivityTimeout","timeoutId","transcript","confirmRecording","$i18n","stopRecording","overlayElement","div8","div7","t4","t4_value","files","prompt","command","selectedPromptIdx","filteredPrompts","selectUp","selectDown","confirmPrompt","text","clipboardText","err","clipboardItems","imageUrl","item","type","blob","chatInputElement","words","findWordIndices","word","promptIdx","$prompts","p","a","b","func","show_if_1","t6_value","t6","s","selectedIdx","filteredItems","filteredDocs","collections","findByName","obj","confirmSelect","doc","removeLastWordFromString","confirmSelectWeb","url","confirmSelectYoutube","docIdx","isValidHttpUrl","$documents","arr","tag","filteredCollections","collection","src_url_equal","img","img_src_value","img_alt_value","_d","filteredModels","model","modelIdx","$models","show_if_2","commandElement","uploadWeb","uploadWebToVectorDB","f","uploadYoutubeTranscription","uploadYoutubeTranscriptionToVectorDB","WEBUI_BASE_URL","span","textarea","textarea_placeholder_value","form","inputmenu_changes","fileitem_changes","create_if_block_6","button_disabled_value","create_if_block_8","create_if_block_7","input","transparentBackground","submitPrompt","stopResponse","autoScroll","atSelectedModel","selectedModels","chatTextAreaElement","filesInputElement","commandsElement","inputFiles","dragged","user","availableToolIds","messages","visionCapableModels","scrollToBottom","element","uploadFileHandler","fileItem","uploadedFile","uploadFile","WEBUI_API_BASE_URL","SUPPORTED_FILE_TYPE","SUPPORTED_FILE_EXTENSIONS","processFileItem","processDocToVectorDB","inputFilesHandler","dropZone","handleKeyDown","onDragOver","onDragLeave","onDrop","_inputFiles","response","func_1","fileIdx","func_2","$_user","$mobile","isCtrlPressed","commandsContainerElement","regenerateButton","userMessageElement","editButton","commandOptionButton","fullPrompt","clipboardData","track","showCallOverlay","m","selector_changes","showSetDefault","saveDefaultModel","it","settings","updateUserSettings","selectedModelIdx","tags","Tags","tags_changes","saveAs","fileSaver","shareEnabled","shareHandler","downloadHandler","chat","downloadTxt","_chat","chatText","message","downloadPdf","downloadChatAsPDF","downloadJSONExport","usermenu_changes","nav","initNewChat","title","$WEBUI_NAME","showModelSelector","showControls","showShareChatModal","showDownloadChatModal","showSidebar","$showSidebar","showArchivedChats","option","option_value_value","add_render_callback","select0","select1","option0","option1","tab","selectedId","valvesSpec","valves","debounceTimer","debounceSubmitHandler","submitHandler","getUserValves","getToolUserValvesById","getToolUserValvesSpecById","getFunctionUserValvesById","getFunctionUserValvesSpecById","property","v","updateToolUserValvesById","updateFunctionUserValvesById","select_value","set_input_value","hr0","hr1","models","chatFiles","params","devices","device","button0","button1","create_if_block_9","_f","_e","_i","_h","_g","style","circle0","circle1","circle2","video","canvas","create_if_block_5","eventTarget","chatId","modelId","wakeLock","assistantSpeaking","emoji","camera","cameraStream","chatStreaming","hasStartedSpeaking","audioStream","videoInputDevices","selectedVideoInputDeviceId","getVideoInputDevices","startCamera","startVideoStream","stopVideoStream","takeScreenshot","context","dataURL","stopCamera","_responses","stopRecordingCallback","_continue","$showCallOverlay","_audioChunks","stopAudioStream","lastSoundTime","stopAllAudio","finishedMessages","currentMessageId","currentUtterance","speakSpeechSynthesisHandler","voices","getVoicesLoop","voice","r","playAudio","audio","audioElement","audioAbortController","audioCache","emojiCache","fetchAudio","generateEmoji","synthesizeOpenAISpeech","blobUrl","monitorAndPlayAudio","signal","setWakeLock","chatStartHandler","chatEventHandler","chatFinishHandler","onDestroy","div1_intro","create_in_transition","fly","size","modalElement","isTopModal","modals","slide","largeScreen","mediaQuery","handleMediaQuery","messageinput_changes","each_value","ensure_array_like","document_1","title_value","chatcontrols_changes","processing","chatIdProp","loaded","stopResponseFlag","messagesContainerElement","showEventConfirmation","eventConfirmationTitle","eventConfirmationMessage","eventConfirmationInput","eventConfirmationInputPlaceholder","eventConfirmationInputValue","eventCallback","selectedModelIds","history","chatIdUnsubscriber","cb","$chatId","continueButton","onMessageHandler","inputElement","$socket","$temporaryChatEnabled","goto","$page","userSettings","getUserSettings","chatInput","loadChat","getChatById","getTags","chatContent","convertMessagesToHistory","createMessagesList","responseMessageId","chatCompletedHandler","mermaid","chatCompleted","updateChatById","currentChatPage","chats","getChatList","$currentChatPage","chatActionHandler","actionId","chatAction","getChatEventEmitter","userPrompt","_raw","_files","array","userMessageId","uuidv4","userMessage","sendPrompt","parentId","newChat","responseMessageIds","_modelIdx","responseMessage","createNewChat","_chatId","userContext","queryMemory","acc","createdAtTimestamp","createdAtDate","chatEventEmitter","getWebSearchResults","_response","sendPromptOpenAI","sendPromptOllama","messagesBody","promptTemplate","$user","getAndUpdateUserLocation","baseMessage","imageUrls","lastImageIndex","generateChatCompletion","token","str","splitStream","lines","line","status","messageContentParts","getMessageContentParts","notification","copyToClipboard","_j","saveChatHandler","lastMessageContentPart","_m","_l","_k","_title","generateChatTitle","setChatTitle","generateOpenAIChatCompletion","idx","textStream","update","citations","usage","handleOpenAIError","_o","_n","_p","_s","_r","_q","errorMessage","innerError","regenerateResponse","continueGeneration","generateTitle","responseId","searchQuery","generateSearchQuery","results","runWebSearch","getTagsById","mergeResponses","messageId","responses","mergedResponse","generateMoACompletion","bannerId","$banners","_messages","currentMessage","div68","div50","div49","div25","div12","div11","div18","div13","div17","div24","div19","div23","div48","div30","div26","div29","div36","div31","div35","div42","div37","div41","div47","div43","div46","div52","div51","div67","div66","div65","div56","div53","div55","div60","div57","div59","div64","div61","div63","t11","t11_value","t17","t17_value","t25","t25_value","t33","t33_value","t39","t39_value","t47","t47_value","t55","t55_value","t61","t61_value","t63","t63_value","t67","t67_value","t71","t71_value","showDocsHandler","showShortcutsHandler","showShortcuts"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4]}